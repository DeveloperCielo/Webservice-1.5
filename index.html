<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <title>Integração Webservice 1.5</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <link href="https://www.cielo.com.br/wps/contenthandler/!ut/p/digest!3SvhW8ACOLyj_90YHxPhKQ/war/cielo-tema/themes/estatico/images/favicon.ico" rel="shortcut icon" type="image/x-icon" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="javascripts/all.js" type="text/javascript"></script>

    <script>
    $(function() {
        setupLanguages(["xml"]);

        var _wr = function(type) {
            var orig = history[type];
            return function() {
                var rv = orig.apply(this, arguments);
                var e = new Event(type);

                e.arguments = arguments;
                window.dispatchEvent(e);
                return rv;
            };
        };

        history.pushState = _wr('pushState'), history.replaceState = _wr('replaceState');

        window.onhashchange = function() {
            ga('send', 'event', 'navigation','click', window.location.href);
        };

        window.addEventListener('replaceState', function(e) {
            ga('send', 'event', 'navigation','scroll', window.location.href);
        });

        window.addEventListener('languagechange', function(e) {
            ga('send', 'event', 'language','change', e.detail);
        });
    });

    </script>
    <script async src='//www.google-analytics.com/analytics.js'></script>
    <script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;

    ga('create', 'UA-8516386-7', {'cookieDomain': 'auto', 'alwaysSendReferrer': true});
    ga('create', 'UA-31855766-1', {'name': 'iMasters', 'cookieDomain': 'auto', 'alwaysSendReferrer': true});

    ga("set", "transport", "beacon");
    ga('send', 'pageview');
    </script>
</head>

<body class="index">
    <a href="#" id="nav-button">
        <span>
            NAV
            <img src="images/navbar.png" />
        </span>
    </a>
    <div class="tocify-wrapper">
        <ul class="languages">
            <li class="english"><a href="english.html" title="English version">English version</a></li>
            <li class="portuguese"><a href="index.html" title="Versão em português">Versão em português</a></li>
        </ul>
        <img src="images/logo.png" />
        <div class="lang-selector">
            <a href="#" data-language-name="xml">XML</a>
        </div>
        <div class="search">
            <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
        <div id="toc">
        </div>
        <h2 class="toc-footer-title">Materiais complementares</h2>
        <ul class="toc-footer">
            <li><a href='/Boas-praticas-de-ecommerce/'>Boas práticas de E-Commerce</a></li>
            <li><a href='/Webservice-1.5-FAQ'>Perguntas frequentes</a></li>
            <li><a href='/Webservice-1.5-Processamento-em-lote/'>Processamento em lote</a></li>
        </ul>
        <div class="links-footer">
            <ul class="link-list">
                <li class="cielo"><a href="https://www.cielo.com.br/ecommerce">Cielo</a></li>
                <li class="github"><a href="https://github.com/developercielo">Cielo</a></li>
                <li class="desenvolvedores"><a href="https://www.cielo.com.br/desenvolvedores">Cielo</a></li>
            </ul>
        </div>
    </div>
    <div class="page-wrapper">
        <div class="dark-box"></div>
        <div class="content">
                <h1 id="integração-webservice-1.5">Integração Webservice 1.5</h1>

<p>O objetivo desta documentação é orientar o desenvolvedor sobre como integrar com a solução Webservice da Cielo, descrevendo as funcionalidades, os métodos a serem utilizados, listando informações a serem enviadas e recebidas, e provendo exemplos.</p>

<p>O mecanismo de integração com o Cielo E-commerce é simples, de modo que apenas conhecimentos intermediários em linguagem de programação para Web, requisições HTTP/HTTPS e manipulação de arquivos XML, são necessários para implantar a solução Cielo E-commerce com sucesso. É importante destacar para utilizar essa plataforma, o website deve estar em confirmidade com regras de segurança ou utilizar a certificação PCI. Para dúvidas sobre segurança web, favor encaminhar email para: <a href="mailto:e-seg@cielo.com.br">Segurança Web</a>.</p>

<p>Após a conclusão do credenciamento e recebimento das instruções é preciso desenvolver a integração utilizando como guia este manual. Assim que a integração estiver concluída, é necessário preencher completamente o formulário de homologação e enviá-lo para o Suporte Web do Cielo E-commerce que informará ao estabelecimento a chave de segurança.</p>

<p>Por fim, após o término do desenvolvimento, é preciso dar início à homologação junto à Cielo
para iniciar a operação no ambiente de produção.</p>

<aside class="notice">Veja a seção <a href="#Homologacao">Homologação</a> para instruções sobre o processo de homologação</aside>

<h2 id="suporte-cielo">Suporte Cielo</h2>

<p>Após a leitura deste manual, caso ainda persistam dúvidas (técnicas ou não), a Cielo disponibiliza o suporte técnico 24 horas por dia, 7 dias por semana em idiomas (Português e Inglês), nos seguintes contatos:</p>

<ul>
<li>+55 4002-9700 – <em>Capitais e Regiões Metropolitanas</em></li>
<li>+55 0800-570-1700 – <em>Demais Localidades</em></li>
<li>+55 11 2860-1348 – <em>Internacionais</em>

<ul>
<li>Opção 1 – <em>Suporte técnico;</em></li>
<li>Opção 2 – <em>Credenciamento E-commerce.</em></li>
</ul></li>
<li>Email: <a href="mailto:cieloecommerce@cielo.com.br">cieloecommerce@cielo.com.br</a></li>
</ul>

<h2 id="glossário">Glossário</h2>

<p>Para facilitar o entendimento, listamos abaixo um pequeno glossário com os principais termos relacionados ao E-commerce, ao mercado de cartões e adquirencia:</p>

<ul>
<li><strong>Autenticação</strong>: processo para assegurar que o comprador é realmente aquele quem diz ser (portador legítimo), geralmente ocorre no banco emissor com uso de um token digital ou cartão com chaves de segurança.</li>
<li><strong>Autorização</strong>: processo para verificar se uma compra pode ou não ser realizada com um cartão. Nesse momento, são feitas diversas verificações com o cartão e com o portador (ex.: adimplência, bloqueios, etc.) É também neste momento que o limite do cartão é sensibilizado com o valor da transação.</li>
<li><strong>Cancelamento</strong>: processo para cancelar uma compra realizada com cartão.</li>
<li><strong>Captura</strong>: processo que confirma uma autorização que foi realizada previamente. Somente após a captura, é que o portador do cartão poderá visualizá-la em seu extrato ou fatura.</li>
<li><strong>Chave de acesso</strong>: é um código de segurança específico de cada loja, gerado pela Cielo, usada para realizar a autenticação e comunicação em todas as mensagens trocadas com a Cielo. Também conhecido como chave de produção e key data.</li>
<li><strong>Comprador</strong>: é o aquele que efetua compra na loja virtual.</li>
<li><strong>Emissor (ou banco emissor)</strong>: É a instituição financeira que emite o cartão de crédito, débito ou voucher.</li>
<li><strong>Estabelecimento comercial ou EC</strong>: Entidade que responde pela loja virtual.</li>
<li><strong>Gateway de pagamentos</strong>: Empresa responsável pelo integração técnica e processamento das transações.</li>
<li><strong>Número de credenciamento</strong>: é um número identificador que o lojista recebe após seu credenciamento junto à Cielo.</li>
<li><strong>Portador</strong>: é a pessoa que tem o porte do cartão no momento da venda.</li>
<li><strong>SecureCode</strong>: programa internacional da Mastercard para possibilitar a autenticação do comprador no momento de uma compra em ambiente E-commerce.</li>
<li><strong>TID (Transaction Identifier)</strong>: código composto por 20 caracteres que identificada unicamente uma transação Cielo E-commerce.</li>
<li><strong>Transação</strong>: é o pedido de compra do portador do cartão na Cielo.</li>
<li><strong>VBV (Verified by Visa)</strong>: Programa internacional da Visa que possibilita a autenticação do comprador no momento de uma compra em ambiente E-commerce.</li>
</ul>

<aside class="notice">Acesse http://www.mastercard.com.br/securecode para mais detalhes sobre o SecureCode.</aside>

<aside class="notice">Acesse http://www.verifiedbyvisa.com.br para mais detalhes sobre o VBV.</aside>

<h2 id="produtos-e-bandeiras-suportadas">Produtos e Bandeiras suportadas</h2>

<p>A versão atual do Webservice Cielo possui suporte às seguintes bandeiras e produtos:</p>

<table><thead>
<tr>
<th>Bandeira</th>
<th>Crédito à vista</th>
<th>Crédito parcelado Loja</th>
<th>Débito</th>
<th>Voucher</th>
</tr>
</thead><tbody>
<tr>
<td>Visa</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td><em>Não</em></td>
</tr>
<tr>
<td>Master Card</td>
<td>Sim</td>
<td>Sim</td>
<td>Sim</td>
<td><em>Não</em></td>
</tr>
<tr>
<td>American Express</td>
<td>Sim</td>
<td>Sim</td>
<td><em>Não</em></td>
<td><em>Não</em></td>
</tr>
<tr>
<td>Elo</td>
<td>Sim</td>
<td>Sim</td>
<td><em>Não</em></td>
<td><em>Não</em></td>
</tr>
<tr>
<td>Diners Club</td>
<td>Sim</td>
<td>Sim</td>
<td><em>Não</em></td>
<td><em>Não</em></td>
</tr>
<tr>
<td>Discover</td>
<td>Sim</td>
<td><em>Não</em></td>
<td><em>Não</em></td>
<td><em>Não</em></td>
</tr>
<tr>
<td>JCB</td>
<td>Sim</td>
<td>Sim</td>
<td><em>Não</em></td>
<td><em>Não</em></td>
</tr>
<tr>
<td>Aura</td>
<td>Sim</td>
<td>Sim</td>
<td><em>Não</em></td>
<td><em>Não</em></td>
</tr>
</tbody></table>

<h1 id="certificado-extended-validation">Certificado Extended Validation</h1>

<h2 id="o-que-é-certificado-ssl?">O que é Certificado SSL?</h2>

<p>O Certificado SSL para servidor web oferece autenticidade e integridade dos dados de um web site, proporcionando aos clientes das lojas virtuais a garantia de que estão realmente acessando o site que desejam, e não uma um site fraudador.</p>

<p>Empresas especializadas são responsáveis por fazer a validação do domínio e, dependendo do tipo de certificado, também da entidade detentora do domínio.</p>

<h3 id="internet-explorer:">Internet Explorer:</h3>

<p><img alt="Certificado EV Internet Explorer" src="images/certificado-ie.jpg" /></p>

<h3 id="firefox">Firefox</h3>

<p><img alt="Certificado EV Firefox" src="images/certificado-firefox.jpg" /></p>

<h3 id="google-chrome">Google Chrome</h3>

<p><img alt="Certificado EV Google Chrome" src="images/certificado-chrome.jpg" /></p>

<h2 id="o-que-é-certificado-ev-ssl?">O que é Certificado EV SSL?</h2>

<p>O Certificado EV foi lançado no mercado recentemente e garante um nível de segurança maior para os clientes das lojas virtuais.</p>

<p>Trata-se de um certificado de maior confiança e quando o https for acessado a barra de endereço ficará verde, dando mais confiabilidade aos visitantes do site.</p>

<h2 id="como-instalar-o-certificado-extended-validation-no-servidor-da-loja?">Como instalar o Certificado Extended Validation no servidor da Loja?</h2>

<p>Basta instalar os três arquivos a seguir na Trustedstore do servidor. A Cielo não oferece suporte para a instalação do Certificado. Caso não esteja seguro sobre como realizar a instalação do Certificado EV, então você deverá ser contatado o suporte do fornecedor do seu servidor.</p>

<ul>
<li><a href="attachment/Raiz.crt">Certificado Raiz</a></li>
<li><a href="attachment/Intermediaria.crt">Certificado Intermediária</a></li>
<li><a href="attachment/ecommerce.cielo.com.br.crt">Certificado E-Commerce Cielo</a></li>
</ul>

<aside class="notice">Caso seu servidor seja uma distribuição Linux e você tenha familiaridade e acesso ssh, então o <a href="./attachment/cielo.sh">Instalador Linux - cielo.sh</a> poderá ajudá-lo com a instalação. <strong>Apenas utilize o instalador se você souber o que está fazendo</strong>. Na dúvida, entre em contato com o suporte do fornecedor do seu servidor.</aside>

<h2 id="passo-a-passo-para-a-instalação">Passo a Passo para a Instalação</h2>

<h3 id="instalação-no-servidor-da-loja-virtual">Instalação no Servidor da Loja Virtual</h3>

<p>O passo a passo para a instalação do Certificado EV deverá ser contatado o suporte do fornecedor do seu servidor.</p>

<aside class="warning">A Cielo não oferece suporte para a instalação do Certificado.</aside>

<h3 id="acesso-do-cliente-à-loja-virtual">Acesso do Cliente à Loja Virtual</h3>

<p>Normalmente, o browser faz a atualização do Certificado automaticamente, caso não o faça e o cliente entre em contato deverá ser informado os seguintes passos:</p>

<h4 id="1o-passo:">1o Passo:</h4>

<p>Salvar os três arquivos abaixo em uma pasta nova, ou que relembre facilmente, pois será utilizada posteriormente:</p>

<ul>
<li><a href="attachment/Raiz.crt">Certificado Raiz</a></li>
<li><a href="attachment/Intermediaria.crt">Certificado Intermediária</a></li>
<li><a href="attachment/ecommerce.cielo.com.br.crt">Certificado E-Commerce Cielo</a></li>
</ul>

<h4 id="2o-passo:">2o Passo:</h4>

<p>No “Internet Explorer”, clique no menu “Ferramentas” e acesse as “Opções da Internet”:</p>

<p><img alt="Instalar IE" src="images/certificado-instalar-ie-1.jpg" /></p>

<p>No “Firefox”, clique no menu “Abrir Menu” e acesse “Avançado” e “Opções”:</p>

<p><img alt="Instalar FF" src="images/certificado-instalar-ff-1.jpg" /></p>

<p>No “Chrome”, clique no “Personalizar e Controlar o Google Chrome” e acesse “Configurações” e “Mostrar configurações avançadas&hellip; “Alterar Configurações de Proxy e “Conteúdo” e Certificados:</p>

<p><img alt="Instalar GC" src="images/certificado-instalar-gc-1.jpg" /></p>

<h4 id="3o-passo:">3o Passo:</h4>

<p>No Internet Explorer, em “Certificados”, clique em “Importar”.</p>

<p><img alt="Instalar IE" src="images/certificado-instalar-ie-2.jpg" /></p>

<p>No Firefox clique em “Ver Certificados”, clique em “Importar”</p>

<p><img alt="Instalar FF" src="images/certificado-instalar-ff-2.jpg" /></p>

<p>No Chrome clique em “Gerenciar Certificados”, clique em “Importar”</p>

<p><img alt="Instalar GC" src="images/certificado-instalar-gc-2.jpg" /></p>

<h4 id="4o-passo:">4o Passo:</h4>

<p>No Internet Explorer e Chrome “Assistente para Importação de Certificados”, clique em “Avançar”.</p>

<p><img alt="Instalar IE e GC" src="images/certificado-instalar-ie-gc-3.jpg" /></p>

<p><img alt="Instalar IE e GC" src="images/certificado-instalar-ie-gc-4.jpg" /></p>

<p>No Firefox “Aba Servidores ”, clique em “Importar”</p>

<p><img alt="Instalar FF" src="images/certificado-instalar-ff-3.jpg" /></p>

<h4 id="5o-passo:">5o Passo:</h4>

<p>No Chrome e Internet Explorer “Assistente para Importação de Certificados”, clique em “Procurar”, procure a pasta onde estão os arquivos e selecione o arquivo “ecommerce.cielo.com.br.crt, clique em “Abrir” e em seguida “Avançar”.</p>

<p><img alt="Instalar IE e GC" src="images/certificado-instalar-ie-gc-5.jpg" /></p>

<p><img alt="Instalar IE e GC" src="images/certificado-instalar-ie-gc-6.jpg" /></p>

<h4 id="6o-passo:">6o Passo:</h4>

<p>Selecionar a opção desejada: adicionar o Certificado em uma pasta padrão ou procurar a pasta de sua escolha.</p>

<p><img alt="Instalar IE e GC" src="images/certificado-instalar-ie-gc-7.jpg" /></p>

<h4 id="7o-passo:">7o Passo:</h4>

<p>Clique em “Concluir”.</p>

<p><img alt="Instalar IE e GC" src="images/certificado-instalar-ie-gc-8.jpg" /></p>

<h4 id="8o-passo:">8o Passo:</h4>

<p>Clique em “Ok” para concluir a importação.</p>

<p><img alt="Instalar IE e GC" src="images/certificado-instalar-ie-gc-9.jpg" /></p>

<aside class="notice">No Firefox não consta a mensagem de Importação com Êxito, apenas conclui a importação.</aside>

<p>O Certificado poderá ser visualizado na aba padrão “Outras Pessoas” ou na escolhida pelo cliente.</p>

<p><img alt="Instalar IE e GC" src="images/certificado-instalar-ie-gc-10.jpg" /></p>

<h4 id="9o-passo:">9o Passo:</h4>

<p>Repita o mesmo procedimento para os 3 arquivos enviados.</p>

<h2 id="dúvidas">Dúvidas</h2>

<p>Em caso de dúvidas em qualquer etapa ou outras informações técnicas, entre em contato com o Suporte Web do Cielo e-Commerce nos seguintes canais:</p>

<ul>
<li><strong>Email:</strong> <a href="mailto:cieloecommerce@cielo.com.br">cieloecommerce@cielo.com.br</a></li>
<li><strong>Capitais:</strong> 4002-9700</li>
<li><strong>Demais Cidades:</strong> 0800 570 1700</li>
</ul>

<p>Horário de atendimento: 24h por dia, 7 dias por semana.</p>

<h1 id="visão-geral">Visão Geral</h1>

<p>Neste manual será apresentado uma visão geral do Cielo E-commerce e o mecanismo tecnológico no formato de integração Webservice (chamado nas versões anteriores de Buy Page Loja).</p>

<p>Para informações sobre a integração no formato do Checkout Cielo (chamado nas versões anteriores de Buy Page Cielo ou Solução Integrada) acesse: <a href="https://www.cielo.com.br/ecommerce">https://www.cielo.com.br/ecommerce</a>.</p>

<p>Para todo pedido de compra, a meta é efetivá-la em uma venda. Uma venda com cartão pode ser caracterizado em uma transação autorizada e capturada.</p>

<aside class="warning">Uma transação autorizada somente gera o crédito para o lojista se ela for capturada (ou confirmada).</aside>

<h2 id="características-da-solução">Características da solução</h2>

<p>A solução Webservice da plataforma Cielo E-commerce foi desenvolvida com tecnologia XML, que é padrão de mercado e independe da tecnologia utilizada por nossos clientes. Dessa forma, é possível integrar-se utilizando as mais variadas linguagens de programação, tais como: ASP, ASP. Net, Java, PHP, Ruby, Python, etc.</p>

<p>Entre outras características, os atributos que mais se destacam na plataforma Cielo E-commerce:</p>

<ul>
<li><strong>Ausência de aplicativos proprietários</strong>: não é necessário instalar aplicativos no ambiente da loja virtual em nenhuma hipótese.</li>
<li><strong>Simplicidade</strong>: o protocolo utilizado é puramente o HTTPS, sem necessidade do uso de SOAP.</li>
<li><strong>Facilidade de credenciamento</strong>: o tratamento das credenciais do cliente (número de afiliação e chave de acesso) trafega na mensagem, em campos comuns do XML, sem necessidade de atributos especiais, como por exemplo, SOAP Header.</li>
<li><strong>Segurança</strong>: a troca de informações se dá sempre entre o Servidor da Loja e da Cielo, ou seja, sem o browser do comprador.</li>
<li><strong>Multiplataforma</strong>: a integração é realizada através de Web Service, em um único Endpoint.</li>
</ul>

<h2 id="considerações-sobre-a-integração">Considerações sobre a integração</h2>

<ul>
<li>Todas as requisições a Web Service da Cielo devem conter o nó de autenticação do lojista, composto pelo número de credenciamento e chave de acesso.</li>
<li>O cadastro da loja deve estar ativo junto à Cielo.</li>
<li>Deve-se definir um timeout adequado nas requisições HTTP à Cielo; recomendamos 30 segundos.</li>
<li>O certificado Root da entidade certificadora (CA) de nosso Web Service deve estar cadastrado na Truststore a ser utilizada. Como nossa certificadora é de ampla aceitação no mercado, é provável que ela já esteja registrada na Truststore do próprio sistema operacional.</li>
<li>Disponibilizamos no kit de integração o arquivo ecommerce.xsd para facilitar a validação das restrições de formato, tamanho dos campos, tipos e domínios de dados.</li>
<li>Em todas as mensagens a data/hora deverá seguir o formato: <code class="prettyprint">aaaa-MM-ddTHH24:mm:ss</code>. Exemplo: 2011-12-21T11:32:45.</li>
<li>Os valores monetários são sempre tratados como valores inteiros, sem representação das casas decimais, sendo que os dois últimos dígitos são considerados como os centavos. Exemplo: R$ 1.286,87 é representado como 128687; R$ 1,00 é representado como 100.</li>
</ul>

<aside class="notice">Veja a seção Certificado Digital para informações sobre os certificados Cielo</aside>

<h2 id="arquitetura">Arquitetura</h2>

<p>A integração é realizada através de serviços disponibilizados como Web Services. O modelo empregado é bastante simples: há uma única URL (endpoint) que recebe os POSTs via HTTPs e, dependendo do formato do XML enviado, uma determinada operação é realizada.</p>

<p>A chamada ao Web Service é resumida por:</p>

<ul>
<li>A mensagem em formato XML, definida de acordo com a funcionalidade.</li>
<li>O destino (ambiente de teste ou de produção).</li>
<li>O retorno em formato XML, que pode ser: <code class="prettyprint">&lt;transacao/&gt;</code>, <code class="prettyprint">&lt;retorno-token&gt;</code> ou <code class="prettyprint">&lt;erro/&gt;</code>.</li>
</ul>
<pre><code class="highlight plaintext">POST /servicos/ecommwsec.do HTTP/1.1
Host: ecommerce.cielo.com.br
Content-Type: application/x-www-form-urlencoded
Content-Length: length
mensagem=&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;&lt;requisicao-captura id="3e22bdd0-2017-4756-80b7-35a532e6c973" versao="1.2.1"&gt;&lt;tid&gt;10069930690101012005&lt;/tid&gt;&lt;dados-ec&gt;&lt;numero&gt;1006993069&lt;/numero&gt;&lt;chave&gt;25fbb99741c739dd84d7b06ec78c9bac718838630f30b112d033ce2e621b34f3&lt;/chave&gt;&lt;/dados-ec&gt;&lt;valor&gt;3880&lt;/valor&gt;&lt;/requisicao-captura&gt;
</code></pre>

<h2 id="transação">Transação</h2>

<p>O elemento central do Cielo E-commerce é a transação, criada a partir de uma requisição HTTP ao Webservice da Cielo. A identificação única de uma transação na Cielo é feita através do campo TID, que está presente no retorno das mensagens de autorização. Esse campo é essencial para realizar consultas, capturas e cancelamentos.</p>

<p>A partir da criação de uma transação, ela pode assumir os seguintes status:</p>

<p><img alt="status transações" src="images/status.png" /></p>

<p>As transições de status podem ser realizadas através da troca de mensagens entre a loja e a Cielo, ou de forma automática, por exemplo, quando o prazo para a captura de transação autorizada expirar.</p>

<h1 id="criando-transações">Criando transações</h1>

<p>Todas as transações no Cielo E-commerce iniciam-se através de um POST (HTTPS) ao Web Service da Cielo com uma mensagem XML <code class="prettyprint">&lt;requisicao-transacao&gt;</code>, cujo conjunto de TAGS determinam as configurações de uma transação.</p>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dados-ec&gt;</span>
    <span class="nt">&lt;numero&gt;</span>1006993069<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;chave&gt;</span>25fbb997438630f30b112d033ce2e621b34f3<span class="nt">&lt;/chave&gt;</span>
  <span class="nt">&lt;/dados-ec&gt;</span>
  <span class="nt">&lt;dados-portador&gt;</span>
    <span class="nt">&lt;numero&gt;</span>4012001038443335<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;validade&gt;</span>201508<span class="nt">&lt;/validade&gt;</span>
    <span class="nt">&lt;indicador&gt;</span>1<span class="nt">&lt;/indicador&gt;</span>
    <span class="nt">&lt;codigo-seguranca&gt;</span>973<span class="nt">&lt;/codigo-seguranca&gt;</span>
    <span class="nt">&lt;token/&gt;</span>
  <span class="nt">&lt;/dados-portador&gt;</span>
  <span class="nt">&lt;dados-pedido&gt;</span>
    <span class="nt">&lt;numero&gt;</span>178148599<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
    <span class="nt">&lt;moeda&gt;</span>986<span class="nt">&lt;/moeda&gt;</span>
    <span class="nt">&lt;data-hora&gt;</span>2011-12-07T11:43:37<span class="nt">&lt;/data-hora&gt;</span>
    <span class="nt">&lt;descricao&gt;</span>[origem:10.50.54.156]<span class="nt">&lt;/descricao&gt;</span>
    <span class="nt">&lt;idioma&gt;</span>PT<span class="nt">&lt;/idioma&gt;</span>
    <span class="nt">&lt;taxa-embarque/&gt;</span>
    <span class="nt">&lt;soft-descriptor/&gt;</span>
  <span class="nt">&lt;/dados-pedido&gt;</span>
  <span class="nt">&lt;forma-pagamento&gt;</span>
    <span class="nt">&lt;bandeira&gt;</span>visa<span class="nt">&lt;/bandeira&gt;</span>
    <span class="nt">&lt;produto&gt;</span>A<span class="nt">&lt;/produto&gt;</span>
    <span class="nt">&lt;parcelas&gt;</span>1<span class="nt">&lt;/parcelas&gt;</span>
  <span class="nt">&lt;/forma-pagamento&gt;</span>
  <span class="nt">&lt;url-retorno&gt;</span>http://localhost/lojaexemplo/retorno.jsp<span class="nt">&lt;/url-retorno&gt;</span>
  <span class="nt">&lt;autorizar&gt;</span>1<span class="nt">&lt;/autorizar&gt;</span>
  <span class="nt">&lt;capturar&gt;</span>false<span class="nt">&lt;/capturar&gt;</span>
  <span class="nt">&lt;campo-livre&gt;</span>Informações extras<span class="nt">&lt;/campo-livre&gt;</span>
  <span class="nt">&lt;bin&gt;</span>455187<span class="nt">&lt;/bin&gt;</span>
  <span class="nt">&lt;gerar-token&gt;</span>false<span class="nt">&lt;/gerar-token&gt;</span>
  <span class="nt">&lt;avs&gt;</span>
  <span class="cp">&lt;![CDATA[
    &lt;dados-avs&gt;</span>
      <span class="nt">&lt;endereco&gt;</span>Rua Teste AVS<span class="nt">&lt;/endereco&gt;</span>
      <span class="nt">&lt;complemento&gt;</span>Casa<span class="nt">&lt;/complemento&gt;</span>
      <span class="nt">&lt;numero&gt;</span>123<span class="nt">&lt;/numero&gt;</span>
      <span class="nt">&lt;bairro&gt;</span>Vila AVS<span class="nt">&lt;/bairro&gt;</span>
      <span class="nt">&lt;cep&gt;</span>12345-123<span class="nt">&lt;/cep&gt;</span>
    <span class="nt">&lt;/dados-avs&gt;</span>
  ]]&gt;
  <span class="nt">&lt;/avs&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>
</code></pre>

<aside class="notice">Todas as mensagens devem estar formatadas corretamente segundo especificado no <a href="attachment/ecommerce.xsd">XML Schema ecommerce.xsd</a></aside>

<h3 id="raiz">raiz</h3>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#dados-ec">dados-ec</a></td>
<td>n/a</td>
<td>Sim</td>
<td>n/a</td>
<td>Dados do estabelecimento comercial</td>
</tr>
<tr>
<td><a href="#dados-portador">dados-portador</a></td>
<td>n/a</td>
<td>Sim</td>
<td>n/a</td>
<td>Dados do cartão</td>
</tr>
<tr>
<td><a href="#dados-pedido">dados-pedido</a></td>
<td>n/a</td>
<td>Sim</td>
<td>n/a</td>
<td>Dados do pedido</td>
</tr>
<tr>
<td><a href="#forma-pagamento">forma-pagamento</a></td>
<td>n/a</td>
<td>Sim</td>
<td>n/a</td>
<td>Forma de pagamento</td>
</tr>
<tr>
<td>url-retorno</td>
<td>Alfanumérico</td>
<td>Sim</td>
<td>1..1024</td>
<td>URL da página de retorno. É para essa página que a Cielo vai direcionar o browser ao fim da autenticação ou da autorização. Não é obrigatório apenas para autorização direta, porém o campo dever ser inserido como <code class="prettyprint">null</code>.</td>
</tr>
<tr>
<td>capturar</td>
<td>Boolean</td>
<td>Sim</td>
<td>n/a</td>
<td><code class="prettyprint">true</code> ou <code class="prettyprint">false</code>. Define se a transação será automaticamente capturada caso seja autorizada.</td>
</tr>
<tr>
<td>campo-livre</td>
<td>Alfanumérico</td>
<td>Opcional</td>
<td>0..128</td>
<td>Campo livre disponível para o Estabelecimento.</td>
</tr>
<tr>
<td>bin</td>
<td>Numérico</td>
<td>Opcional</td>
<td>6</td>
<td>Seis primeiros números do cartão.</td>
</tr>
<tr>
<td>gerar-token</td>
<td>Boolean</td>
<td>Opcional</td>
<td>n/a</td>
<td><code class="prettyprint">true</code> ou <code class="prettyprint">false</code>. Define se a transação atual deve gerar um token associado ao cartão.</td>
</tr>
<tr>
<td>avs#avs</td>
<td>Alfanumérico</td>
<td>Opcional</td>
<td>n/a</td>
<td>String contendo um bloco XML, encapsulado pelo <code class="prettyprint">CDATA</code>, contendo as informações necessárias para realizar a consulta ao serviço.</td>
</tr>
</tbody></table>

<h3 id="dados-ec">dados-ec</h3>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>numero</td>
<td>Numérico</td>
<td>Sim</td>
<td>1..20</td>
<td>Número de afiliação da loja com a Cielo.</td>
</tr>
<tr>
<td>chave</td>
<td>AlfaNumérico</td>
<td>Sim</td>
<td>1..100</td>
<td>Chave de acesso da loja atribuída pela Cielo.</td>
</tr>
</tbody></table>

<h3 id="dados-portador">dados-portador</h3>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>numero</td>
<td>Numérico</td>
<td>Sim</td>
<td>19</td>
<td>Número do cartão.</td>
</tr>
<tr>
<td>validade</td>
<td>Numérico</td>
<td>Sim</td>
<td>6</td>
<td>Validade do cartão no formato aaaamm. Exemplo: 201212 (dez/2012).</td>
</tr>
<tr>
<td>indicador</td>
<td>Numérico</td>
<td>Sim</td>
<td>1</td>
<td>Indicador sobre o envio do Código de segurança: <strong>0</strong> – não informado, <strong>1</strong> – informado, <strong>2</strong> – ilegível, <strong>9</strong> – inexistente</td>
</tr>
<tr>
<td>codigo-seguranca</td>
<td>Numérico</td>
<td>Condicional</td>
<td>3..4</td>
<td>Obrigatório se o indicador for <strong>1</strong></td>
</tr>
<tr>
<td>nome-portador</td>
<td>Alfanumérico</td>
<td>Opcional</td>
<td>0..50</td>
<td>Nome como impresso no cartão</td>
</tr>
<tr>
<td>token</td>
<td>Alfanumérico</td>
<td>Condicional</td>
<td>0..100</td>
<td>Token que deve ser utilizado em substituição aos dados do cartão para uma autorização direta ou uma transação recorrente. Não é permitido o envio do token junto com os dados do cartão na mesma transação.</td>
</tr>
</tbody></table>

<h3 id="dados-pedido">dados-pedido</h3>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>numero</td>
<td>Alfanumérico</td>
<td>Sim</td>
<td>1..20</td>
<td>Número do pedido da loja. <strong>Recomenda-se que seja um valor único por pedido.</strong></td>
</tr>
<tr>
<td>valor</td>
<td>Numérico</td>
<td>Sim</td>
<td>1..12</td>
<td>Valor a ser cobrado pelo pedido (já deve incluir valoresde frete, embrulho, custos extras, taxa de embarque, etc). Esse valor é o que será debitado do consumidor.</td>
</tr>
<tr>
<td>moeda</td>
<td>Numérico</td>
<td>Sim</td>
<td>3</td>
<td>Código numérico da moeda na norma ISO 4217. <strong>Para o Real, o código é 986</strong>.</td>
</tr>
<tr>
<td>data-hora</td>
<td>Alfanumérico</td>
<td>Sim</td>
<td>19</td>
<td>Data hora do pedido. <strong>Formato</strong>: <code class="prettyprint">aaaa-MM-ddTHH24:mm:ss</code></td>
</tr>
<tr>
<td>descricao</td>
<td>Alfanumérico</td>
<td>Opcional</td>
<td>0..1024</td>
<td>Descrição do pedido</td>
</tr>
<tr>
<td>idioma</td>
<td>Alfanumérico</td>
<td>Opcional</td>
<td>2</td>
<td>Idioma do pedido: PT (português), EN (inglês) ou ES (espanhol). Com base nessa informação é definida a língua a ser utilizada nas telas da Cielo. <strong>Caso não seja enviado, o sistema assumirá “PT”</strong>.</td>
</tr>
<tr>
<td>taxa-embarque</td>
<td>Numérico</td>
<td>Opcional</td>
<td>1..9</td>
<td>Montante do valor da autorização que deve ser destinado à taxa de embarque.</td>
</tr>
<tr>
<td>soft-descriptor</td>
<td>Alfanumérico</td>
<td>Opcional</td>
<td>0..13</td>
<td>Texto de até 13 caracteres que será exibido na fatura do portador, após o nome do Estabelecimento Comercial.</td>
</tr>
</tbody></table>

<aside class="notice">O cadastro do cliente está habilitado para transacionar apenas com a moeda REAL, caso necessite de mais informações, contate a central de relacionamento, seu gerente comercial ou o Suporte Web Cielo E-commerce.</aside>

<h3 id="forma-pagamento">forma-pagamento</h3>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>bandeira</td>
<td>Alfanumérico</td>
<td>Sim</td>
<td>n/a</td>
<td>Nome da bandeira (minúsculo): “visa”, “mastercard”, “diners”, “discover”, “elo”, “amex”, “jcb”, “aura”</td>
</tr>
<tr>
<td>produto</td>
<td>Alfanumérico</td>
<td>Sim</td>
<td>1</td>
<td>Código do produto: <strong>1</strong> – Crédito à Vista, <strong>2</strong> – Parcelado loja, <strong>A</strong> – Débito.</td>
</tr>
<tr>
<td>parcelas</td>
<td>Numérico</td>
<td>Sim</td>
<td>1..2</td>
<td>Número de parcelas. <strong>Para crédito à vista ou débito, utilizar 1.</strong></td>
</tr>
</tbody></table>

<aside class="warning">O valor do resultante da divisão do valor do pedido pelo número de parcelas não deve ser
inferior a R$5,00. Caso contrário a transação será negada.</aside>

<h2 id="fluxos-de-integração-e-redirecionamentos">Fluxos de integração e redirecionamentos</h2>

<p>Após a transação ter sido criada, o fluxo de navegação pode ser direcionado ao ambiente da Cielo caso o lojista solicite a autenticação na mensagem XML.</p>

<p>Nessa situação, o sistema do lojista deve obter o valor da TAG <url-autenticacao> do XML de retorno para realizar um redirect no browser do cliente e dar continuidade ao processo. O redirecionamento deve ser realizado em modo Full Screen. Ou seja, não há mais suporte a abertura de pop up. Dessa forma, a partir da tela de checkout deve ser realizado um redirecionamento à URL retornada na criação da transação.</p>

<aside class="notice">Esse redirecionamento pode ser através de um Http Redirect (como no código da Loja Exemplo) ou através de um Javascript.</aside>

<p>Após o processo de autenticação, o fluxo é devolvido ao lojista através da informação presente na TAG <url-retorno>, enviada na primeira requisição para a Cielo.</p>

<p>O diagrama abaixo facilita a visualização do fluxo completo de navegação:</p>

<p><img alt="fluxo" src="images/fluxo.png" /></p>

<aside class="notice">Geralmente, a URL de retorno segue o seguinte formato: https://minhaloja.com.br/pedido?id=12345678. Essa página deve utilizar o número do pedido para buscar internamente o TID que foi retornado pela Cielo. Com esta informação, a página deve realizar uma requisição de Consulta via TID ao Web Service da Cielo e interpretar o resultado para exibir ao cliente</aside>

<p>Por outro lado, quando não há autenticação, não existe troca de contextos ou redirects, e a integração é mais simples:</p>

<p><img alt="fluxo-simples" src="images/fluxo-simples.png" /></p>

<h2 id="tipos-de-retorno">Tipos de retorno</h2>

<p>Há três tipos de retorno que podem ser gerados na resposta do Web Service:</p>

<ol>
<li><code class="prettyprint">&lt;transacao&gt;</code></li>
<li><code class="prettyprint">&lt;retorno-token&gt;</code></li>
<li><code class="prettyprint">&lt;erro&gt;</code></li>
</ol>

<p>Para as operações relacionadas a uma transação (consultas, autorização, captura e cancelamento), a resposta, em caso de sucesso, é sempre um XML do tipo <code class="prettyprint">&lt;transacao&gt;</code>. No caso de uma requisição exclusiva para criação de token, a resposta esperada é <code class="prettyprint">&lt;retorno-token&gt;</code>.</p>

<p>O exemplo ao lado ilustra a forma mais reduzida de uma mensagem de retorno tipo <code class="prettyprint">&lt;transacao&gt;</code>. Basicamente, ela é composta pelos dados do pedido e dados da configuração da transação.</p>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;transacao</span> <span class="na">versao=</span><span class="s">"1.3.0"</span> <span class="na">id=</span><span class="s">"af32f93c-5e9c-4f44-9478-ccc5aca9319e"</span> <span class="na">xmlns=</span><span class="s">"http://ecommerce.cbmp.com.br"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tid&gt;</span>100699306908642F1001<span class="nt">&lt;/tid&gt;</span>
    <span class="nt">&lt;pan&gt;</span>uv9yI5tkhX9jpuCt+dfrtoSVM4U3gIjvrcwMBfZcadE=<span class="nt">&lt;/pan&gt;</span>
    <span class="nt">&lt;dados-pedido&gt;</span>
        <span class="nt">&lt;numero&gt;</span>2132385784<span class="nt">&lt;/numero&gt;</span>
        <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
        <span class="nt">&lt;moeda&gt;</span>986<span class="nt">&lt;/moeda&gt;</span>
        <span class="nt">&lt;data-hora&gt;</span>2013-02-18T16:51:30.852-03:00<span class="nt">&lt;/data-hora&gt;</span>
        <span class="nt">&lt;descricao&gt;</span>[origem:0:0:0:0:0:0:0:1]<span class="nt">&lt;/descricao&gt;</span>
        <span class="nt">&lt;idioma&gt;</span>PT<span class="nt">&lt;/idioma&gt;</span>
        <span class="nt">&lt;taxa-embarque&gt;</span>0<span class="nt">&lt;/taxa-embarque&gt;</span>
    <span class="nt">&lt;/dados-pedido&gt;</span>
    <span class="nt">&lt;forma-pagamento&gt;</span>
        <span class="nt">&lt;bandeira&gt;</span>visa<span class="nt">&lt;/bandeira&gt;</span>
        <span class="nt">&lt;produto&gt;</span>1<span class="nt">&lt;/produto&gt;</span>
        <span class="nt">&lt;parcelas&gt;</span>1<span class="nt">&lt;/parcelas&gt;</span>
    <span class="nt">&lt;/forma-pagamento&gt;</span>
    <span class="nt">&lt;status&gt;</span>4<span class="nt">&lt;/status&gt;</span>
    <span class="nt">&lt;autenticacao&gt;</span>
        <span class="nt">&lt;codigo&gt;</span>4<span class="nt">&lt;/codigo&gt;</span>
        <span class="nt">&lt;mensagem&gt;</span>Transacao sem autenticacao<span class="nt">&lt;/mensagem&gt;</span>
        <span class="nt">&lt;data-hora&gt;</span>2013-02-18T16:51:31.158-03:00<span class="nt">&lt;/data-hora&gt;</span>
        <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
        <span class="nt">&lt;eci&gt;</span>7<span class="nt">&lt;/eci&gt;</span>
    <span class="nt">&lt;/autenticacao&gt;</span>
    <span class="nt">&lt;autorizacao&gt;</span>
        <span class="nt">&lt;codigo&gt;</span>4<span class="nt">&lt;/codigo&gt;</span>
        <span class="nt">&lt;mensagem&gt;</span>Transação autorizada<span class="nt">&lt;/mensagem&gt;</span>
        <span class="nt">&lt;data-hora&gt;</span>2013-02-18T16:51:31.460-03:00<span class="nt">&lt;/data-hora&gt;</span>
        <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
        <span class="nt">&lt;lr&gt;</span>00<span class="nt">&lt;/lr&gt;</span>
        <span class="nt">&lt;arp&gt;</span>123456<span class="nt">&lt;/arp&gt;</span>
        <span class="nt">&lt;nsu&gt;</span>549935<span class="nt">&lt;/nsu&gt;</span>
    <span class="nt">&lt;/autorizacao&gt;</span>
<span class="nt">&lt;/transacao&gt;</span>
</code></pre>

<p>As informações mais importantes são:</p>

<ul>
<li><strong>TID</strong>: é o elo entre o pedido de compra da loja virtual e a transação na Cielo.</li>
<li><strong>URL de autenticação</strong>: aponta à página que dá início à autenticação (quando solicitada).</li>
<li><strong>Status</strong>: é a informação base para a loja controlar a transação.</li>
</ul>

<p>A tabela abaixo detalha as TAGS do XML básico de retorno, identificado pelo nó raiz <code class="prettyprint">&lt;transação&gt;</code>:</p>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>tid</td>
<td>Alfanumérico</td>
<td>1..40</td>
<td>Identificador da transação</td>
</tr>
<tr>
<td>dados-pedido</td>
<td>Idêntico ao nó enviado pela loja na criação da transação.</td>
<td></td>
<td></td>
</tr>
<tr>
<td>forma-pagamento</td>
<td>Idêntico ao nó enviado pela loja na criação da transação.</td>
<td></td>
<td></td>
</tr>
<tr>
<td>status</td>
<td>Numérico</td>
<td>12</td>
<td>Código de status da transação. Veja o apêndice para a lista de status</td>
</tr>
<tr>
<td>url-autenticacao</td>
<td>Alfanumérico</td>
<td>1..256</td>
<td>URL de redirecionamento à Cielo.</td>
</tr>
</tbody></table>

<p>Por fim, há outro tipo de retorno que é empregado toda vez que uma requisição não pode ser executada, seja porque era inválida ou por ter ocorrido falha no seu processamento. Nesse cenário o nó raiz do XML de resposta é do tipo <code class="prettyprint">&lt;erro&gt;</code>.</p>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;erro</span> <span class="na">xmlns=</span><span class="s">"http://ecommerce.cbmp.com.br"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;codigo&gt;</span>001<span class="nt">&lt;/codigo&gt;</span>
  <span class="nt">&lt;mensagem&gt;</span><span class="cp">&lt;![CDATA[O XML informado nao e valido:- string value '' does not match pattern for type of valor element in DadosPedido in namespace http://ecommerce.cbmp. com.br: '&lt;xml-fragment/&gt;]]&gt;</span>
  <span class="nt">&lt;/mensagem&gt;</span>
<span class="nt">&lt;/erro&gt;</span>
</code></pre>

<p>Quando a transação é inválida, podemos classificar os erros em dois tipos:</p>

<ul>
<li><strong>Erros sintáticos</strong>: ocorrem quando a mensagem XML não respeita as regras definidas no arquivo ecommerce.xsd. Por exemplo, uma letra em um campo numérico, ou a ausência de um valor obrigatório;</li>
<li><strong>Erros semânticos</strong>: ocorrem quando uma requisição solicita uma operação não suportada para determinada transação. Por exemplo, tentar capturar uma transação não autorizada, ou ainda, cancelar uma transação já cancelada.</li>
</ul>

<aside class="notice">As mensagens de erro sempre trazem informações adicionais que facilitam o troubleshooting. A tabela que consta no item “Anexos - 6.2. Catálogo de Erros” possui a lista completa com os códigos de erros e suas descrições que devem ser consideradas no desenvolvimento da integração.</aside>

<h2 id="autenticação-e-nível-de-segurança">Autenticação e nível de segurança</h2>

<p>Dependendo da bandeira escolhida, as transações na plataforma Cielo E-commerce podem ser configuradas para serem autenticadas no banco emissor do cartão (portador), a fim de garantir o nível maior de segurança ao lojista. A autenticação não é feita automaticamente entre sistemas, deste modo é necessário que o comprador interaja no processo, conforme será visto a seguir.</p>

<p>Ela acontece sempre no site do banco (Internet Banking), utilizando mecanismos e tecnologias independentes da Cielo. Dessa forma, é possível que o banco utilize token eletrônico e senha, enquanto outro utilize os cartões de senhas ou CPF para autenticar uma transação.</p>

<p>Conforme mostrado anteriormente, a mecânica do redirecionamento é obtida através da tag <code class="prettyprint">&lt;url-autenticacao&gt;</code> que é retornada pela Cielo no XML <transação> no momento da solicitação de autorização ao Web Service.</p>

<p>A autenticação é obrigatória para transações de débito e opcional para o crédito. Atualmente somente Visa e MasterCard suportam essa funcionalidade e consequentemente, somente essas duas bandeiras possuem o produto débito.</p>

<aside class="notice">Consulte os produtos e bandeiras suportadas no item 1.6 Produtos e Bandeiras suportadas.</aside>

<p>Quando há autenticação, o fluxo de execução da autorização acaba sendo feito em duas etapas, conforme mostrado no diagrama abaixo:</p>

<p><img alt="fluxo-autenticacao" src="images/fluxo-autenticacao.png" /></p>

<ol>
<li>fecharPedido() – acontece quando o portador do cartão finaliza o pedido e dá início ao pagamento da compra

<ol>
<li>criarTransacao(autenticada) – o sistema do lojista envia uma requisição XML <code class="prettyprint">&lt;requisicao-transacao&gt;</code> solicitando uma transação autenticada, ou seja, a TAG <autorizar> será 0, 1 ou 2. Em seguida, a Cielo informará no XML de retorno o campo <url-autenticacao> com o endereço que o portador deverá ser redirecionado.</li>
</ol></li>
<li>acessar(url-atenticacao) – o browser do portador é redirecionado ao ambiente da Cielo. Assim que a página da Cielo é acessada, automaticamente ela já é direcionada para o banco emissor (3.1). Esse redirect é tão rápido que é praticamente imperceptível.</li>
<li>autenticar(token, cpf) – o portador estará no ambiente do banco e utilizará algum mecanismo provido pelo próprio emissor para realizar a autenticação da transação (geralmente token, cartão de bingo, cpf, assinatura eletrônica, etc).

<ol>
<li>resultadoAutenticacao() – o banco emissor redireciona o fluxo para a Cielo com o resultado da autenticação. A partir daí, o fluxo volta ao normal, conforme disposto no item “2.3 Arquitetura de integração”.
1.processar() – o sistema da Cielo processa o retorno da autenticação e submete á autorização e, opcionalmente, à captura automática.</li>
<li>enviarRedirect(url-retorno) – o sistema da Cielo envia um redirect ao browser do cliente para o endereço especificado na URL de retorno, fornecida na primeira requisição (<code class="prettyprint">&lt;requisicao-transacao&gt;</code>)

<ol>
<li>acessar(url-retorno) – o browser do portador acessar a URL no ambiente da loja, onde recomendamos que exista uma requisição de consulta via TID ao Web Service da Cielo.</li>
</ol></li>
</ol></li>
</ol>

<h3 id="observações">Observações</h3>

<ul>
<li>Somente o primeiro redirecionamento (1.2: enviarRedirect()) é de responsabilidade da loja virtual.</li>
<li>O comprador é redirecionado ao site do Banco Emissor somente se a autenticação estiver disponível. Caso contrário, a transação prosseguirá à autorização automaticamente (exceto se foi apenas solicitada autenticação).</li>
</ul>

<aside class="notice">Consulte os produtos e bandeiras suportadas no item 1.6 Produtos e Bandeiras suportadas.</aside>

<p>Os pré-requisitos para que uma transação seja autenticada estão relacionados abaixo:</p>

<ul>
<li>Banco e Bandeira devem ser participantes do programa de autenticação;</li>
<li>O BIN do cartão deve ser participante do programa de autenticação;</li>
<li>A configuração da <requisicao-transacao>//<autorizar> deve ser 0, 1 ou 2.</li>
</ul>

<p>Quando há autenticação, o fluxo de execução da autorização acaba sendo feito em duas etapas, conforme mostrado no diagrama abaixo:</p>

<p><img alt="fluxo-autorizacao" src="images/fluxo-autorizacao.png" /></p>

<ol>
<li>fecharPedido() – acontece quando o portador do cartão finaliza o pedido e dá início ao pagamento da compra

<ol>
<li>criarTransacao(autenticada) – o sistema do lojista envia uma requisição XML <requisicao-transacao> solicitando uma transação autenticada, ou seja, a TAG <autorizar> será 0, 1 ou 2. Em seguida, a Cielo informará no XML de retorno o campo <url-autenticacao> com o endereço que o portador deverá ser redirecionado.</li>
<li>acessar(url-atenticacao) – o browser do portador é redirecionado ao ambiente da Cielo. Assim que a página da Cielo é acessada, automaticamente ela já é direcionada para o banco emissor (3.1). Esse redirect é tão rápido que é praticamente imperceptível.</li>
<li>autenticar(token, cpf) – o portador estará no ambiente do banco e utilizará algum mecanismo provido pelo próprio emissor para realizar a autenticação da transação (geralmente token, cartão de bingo, cpf, assinatura eletrônica, etc).</li>
<li>resultadoAutenticacao() – o banco emissor redireciona o fluxo para a Cielo com o resultado da autenticação. A partir daí, o fluxo volta ao normal, conforme disposto no item “2.3 Arquitetura de integração”.

<ol>
<li>processar() – o sistema da Cielo processa o retorno da autenticação e submete á autorização e, opcionalmente, à captura automática.</li>
<li>enviarRedirect(url-retorno) – o sistema da Cielo envia um redirect ao browser do cliente para o endereço especificado na URL de retorno, fornecida na primeira requisição (<code class="prettyprint">&lt;requisicao-transacao&gt;</code>)</li>
</ol></li>
<li>acessar(url-retorno) – o browser do portador acessar a URL no ambiente da loja, onde recomendamos que exista uma requisição de consulta via TID ao Web Service da Cielo.</li>
</ol></li>
</ol>

<h3 id="observações:">Observações:</h3>

<ul>
<li>Somente o primeiro redirecionamento (1.2: enviarRedirect()) é de responsabilidade da loja virtual.</li>
<li>O comprador é redirecionado ao site do Banco Emissor somente se a autenticação estiver disponível. Caso contrário, a transação prosseguirá à autorização automaticamente (exceto se foi apenas solicitada autenticação).</li>
</ul>

<p>Observando o diagrama do item “2.4 Transação”, é possível observar que todas as transações
passarão pelo status “Autenticada” ou “Não autenticada”. Por consequência, todas receberão o nó
<autenticacao> no XML de resposta ao lojista. Abaixo, o XML com o nó de autenticação:</p>

<p>Observando o diagrama da seção <a href="#transação">Transação</a>, é possível observar que todas as transações passarão pelo status “Autenticada” ou “Não autenticada”. Por consequência, todas receberão o nó <code class="prettyprint">&lt;autenticacao&gt;</code> no XML de resposta ao lojista. Abaixo, o XML com o nó de autenticação:</p>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;transacao</span> <span class="na">versao=</span><span class="s">"1.3.0"</span> <span class="na">id=</span><span class="s">"5e445904-963e-4fa1-95cd-55ef88c289cc"</span> <span class="na">xmlns=</span><span class="s">"http://ecommerce.cbmp.com.br"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tid&gt;</span>10069930690864281001<span class="nt">&lt;/tid&gt;</span>
    <span class="nt">&lt;pan&gt;</span>uv9yI5tkhX9jpuCt+dfrtoSVM4U3gIjvrcwMBfZcadE=<span class="nt">&lt;/pan&gt;</span>
    <span class="nt">&lt;dados-pedido&gt;</span>
        <span class="nt">&lt;numero&gt;</span>1739114311<span class="nt">&lt;/numero&gt;</span>
        <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
        <span class="nt">&lt;moeda&gt;</span>986<span class="nt">&lt;/moeda&gt;</span>
        <span class="nt">&lt;data-hora&gt;</span>2013-02-18T15:06:27.523-03:00<span class="nt">&lt;/data-hora&gt;</span>
        <span class="nt">&lt;descricao&gt;</span>[origem:172.16.34.66]<span class="nt">&lt;/descricao&gt;</span>
        <span class="nt">&lt;idioma&gt;</span>PT<span class="nt">&lt;/idioma&gt;</span>
        <span class="nt">&lt;taxa-embarque&gt;</span>0<span class="nt">&lt;/taxa-embarque&gt;</span>
    <span class="nt">&lt;/dados-pedido&gt;</span>
    <span class="nt">&lt;forma-pagamento&gt;</span>
        <span class="nt">&lt;bandeira&gt;</span>visa<span class="nt">&lt;/bandeira&gt;</span>
        <span class="nt">&lt;produto&gt;</span>1<span class="nt">&lt;/produto&gt;</span>
        <span class="nt">&lt;parcelas&gt;</span>1<span class="nt">&lt;/parcelas&gt;</span>
    <span class="nt">&lt;/forma-pagamento&gt;</span>
    <span class="nt">&lt;status&gt;</span>6<span class="nt">&lt;/status&gt;</span>
    <span class="nt">&lt;autenticacao&gt;</span>
        <span class="nt">&lt;codigo&gt;</span>6<span class="nt">&lt;/codigo&gt;</span>
        <span class="nt">&lt;mensagem&gt;</span>Transacao sem autenticacao<span class="nt">&lt;/mensagem&gt;</span>
        <span class="nt">&lt;data-hora&gt;</span>2013-02-18T15:06:28.013-03:00<span class="nt">&lt;/data-hora&gt;</span>
        <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
        <span class="nt">&lt;eci&gt;</span>7<span class="nt">&lt;/eci&gt;</span>
    <span class="nt">&lt;/autenticacao&gt;</span>
    <span class="nt">&lt;autorizacao&gt;</span>
        <span class="nt">&lt;codigo&gt;</span>6<span class="nt">&lt;/codigo&gt;</span>
        <span class="nt">&lt;mensagem&gt;</span>Transação autorizada<span class="nt">&lt;/mensagem&gt;</span>
        <span class="nt">&lt;data-hora&gt;</span>2013-02-18T15:06:28.807-03:00<span class="nt">&lt;/data-hora&gt;</span>
        <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
        <span class="nt">&lt;lr&gt;</span>00<span class="nt">&lt;/lr&gt;</span>
        <span class="nt">&lt;arp&gt;</span>123456<span class="nt">&lt;/arp&gt;</span>
        <span class="nt">&lt;nsu&gt;</span>549928<span class="nt">&lt;/nsu&gt;</span>
    <span class="nt">&lt;/autorizacao&gt;</span>
    <span class="nt">&lt;captura&gt;</span>
        <span class="nt">&lt;codigo&gt;</span>6<span class="nt">&lt;/codigo&gt;</span>
        <span class="nt">&lt;mensagem&gt;</span>Transacao capturada com sucesso<span class="nt">&lt;/mensagem&gt;</span>
        <span class="nt">&lt;data-hora&gt;</span>2013-02-18T15:08:23.031-03:00<span class="nt">&lt;/data-hora&gt;</span>
        <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
    <span class="nt">&lt;/captura&gt;</span>
<span class="nt">&lt;/transacao&gt;</span>
</code></pre>

<p>Os campos apenas do nó <code class="prettyprint">&lt;autenticacao&gt;</code> estão listados na tabela abaixo:</p>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>Numérico</td>
<td>1.2</td>
<td>Código do processamento</td>
</tr>
<tr>
<td>mensagem</td>
<td>Alfanumérico</td>
<td>1..100</td>
<td>Detalhe do processamento</td>
</tr>
<tr>
<td>data-hora</td>
<td>Alfanumérico</td>
<td>19</td>
<td>Data e hora do processamento</td>
</tr>
<tr>
<td>valor</td>
<td>Numérico</td>
<td>1..12</td>
<td>Valor do processamento sem pontuação. Os dois últimos dígitos são os centavos.</td>
</tr>
<tr>
<td>eci</td>
<td>Numérico</td>
<td>2</td>
<td>Nível de segurança.</td>
</tr>
</tbody></table>

<p>O campo ECI (Eletronic Commerce Indicator) representa o quão segura é uma transação. Esse valor deve ser levado em consideração pelo lojista para decidir sobre a captura da transação.</p>

<aside class="warning">O indicador ECI é muito importante, pois é ele que determina as regras de Chargeback.</aside>

<h1 id="catálogo-de-códigos-de-resposta">Catálogo de códigos de resposta</h1>

<h2 id="códigos-de-autorização-lr">Códigos de Autorização LR</h2>

<p>A seguir estão os códigos de resposta que respondem por 99% dos retornos gerados no processo de autorização. Os demais códigos existentes não estão listados pois ocorrem raramente ou em casos específicos. Para estes casos deve-se assumir que eles não são passíveis de retentativa.</p>

<p>Caso tenha uma quantidade elevada de códigos de retorno que não está listado abaixo, entre em contato com o Suporte Web Cielo E-commerce.</p>

<aside class="warning">As descrições abaixo são exclusivas para uso interno do estabelecimento comercial e não devem ser divulgadas para o portador do cartão.</aside>

<aside class="notice">Exceto os códigos AA, AC e GA, todos os outros são gerados pelos emissores/bandeiras.</aside>

<table><thead>
<tr>
<th>Código Resposta LR</th>
<th>Definição</th>
<th>Significado</th>
<th>Ação</th>
<th>Permite Retentativa</th>
</tr>
</thead><tbody>
<tr>
<td>00</td>
<td>Transação autorizada</td>
<td>Transação nacional aprovada com sucesso</td>
<td></td>
<td>n/a</td>
</tr>
<tr>
<td>01</td>
<td>Transação referida pelo banco emissor</td>
<td>Referida pelo banco emissor</td>
<td>Oriente o portador a contatar o banco emissor do cartão</td>
<td>NÃO</td>
</tr>
<tr>
<td>04</td>
<td>Transação não autorizada</td>
<td>Existe algum tipo de restrição no cartão</td>
<td>Oriente o portador a refazer a transação</td>
<td>SIM</td>
</tr>
<tr>
<td>05</td>
<td>Transação não autorizada</td>
<td>Existe algum tipo de restrição no cartão</td>
<td>Oriente o portador a contatar o banco emissor do cartão</td>
<td>SIM</td>
</tr>
<tr>
<td>06</td>
<td>Tente novamente</td>
<td>Falha na autorização</td>
<td>Oriente o portador a refazer a transação</td>
<td>SIM</td>
</tr>
<tr>
<td>07</td>
<td>Cartão com restrição</td>
<td>Existe algum tipo de restrição no cartão</td>
<td>Oriente o portador a contatar o banco emissor do cartão</td>
<td>NÃO</td>
</tr>
<tr>
<td>08</td>
<td>Código de segurança inválido</td>
<td>Código de segurança incorreto</td>
<td>Oriente o portador a refazer a transação digitando o código de segurança corretamente</td>
<td>NÃO</td>
</tr>
<tr>
<td>11</td>
<td>Transação autorizada</td>
<td>Transação internacional aprovada com sucesso</td>
<td></td>
<td>n/a</td>
</tr>
<tr>
<td>13</td>
<td>Valor inválido</td>
<td>Valor inválido</td>
<td>Oriente o portador a refazer a transação digitando o valor correto</td>
<td>NÃO</td>
</tr>
<tr>
<td>14</td>
<td>Cartão inválido</td>
<td>Digitação incorreta do número do cartão</td>
<td>Oriente o portador a verificar o número do cartão e digitar novamente</td>
<td>NÃO</td>
</tr>
<tr>
<td>15</td>
<td>Banco emissor indisponível</td>
<td>Banco emissor indisponível</td>
<td>Oriente o portador a aguardar alguns instantes e tentar novamente</td>
<td>SIM</td>
</tr>
<tr>
<td>21</td>
<td>Cancelamento não efetuado</td>
<td>Cancelamento não localizado no banco emissor</td>
<td>O estabelecimento deve entrar em contato com a Central de Relacionamento Cielo</td>
<td>NÃO</td>
</tr>
<tr>
<td>41</td>
<td>Cartão com restrição</td>
<td>Existe algum tipo de restrição no cartão</td>
<td>Oriente o portador a contatar o banco emissor do cartão</td>
<td>NÃO</td>
</tr>
<tr>
<td>51</td>
<td>Saldo insuficiente</td>
<td>Saldo insuficiente</td>
<td>Oriente o portador a contatar o banco emissor do cartão</td>
<td>SIM</td>
</tr>
<tr>
<td>54</td>
<td>Cartão vencido</td>
<td>Cartão vencido</td>
<td>Oriente o portador a verificar o vencimento do cartão e digitar novamente</td>
<td>NÃO</td>
</tr>
<tr>
<td>57</td>
<td>Transação não permitida</td>
<td>Existe algum tipo de restrição no cartão</td>
<td>Oriente o portador a contatar o banco emissor do cartão</td>
<td>SIM</td>
</tr>
<tr>
<td>60</td>
<td>Transação não autorizada</td>
<td>Existe algum tipo de restrição no cartão</td>
<td>Oriente o portador a contatar o banco emissor do cartão</td>
<td>NÃO</td>
</tr>
<tr>
<td>62</td>
<td>Transação não autorizada</td>
<td>Existe algum tipo de restrição no cartão</td>
<td>Oriente o portador a contatar o banco emissor do cartão</td>
<td>NÃO</td>
</tr>
<tr>
<td>78</td>
<td>Cartão não foi desbloqueado pelo portador</td>
<td>Cartão não foi desbloqueado pelo portador</td>
<td>Oriente o portador a desbloquear o cartão junto ao emissor do cartão</td>
<td>SIM</td>
</tr>
<tr>
<td>82</td>
<td>Erro no cartão</td>
<td>Cartão inválido</td>
<td>Oriente o portador a verificar o número do cartão e digitar novamente</td>
<td>SIM</td>
</tr>
<tr>
<td>91</td>
<td>Banco fora do ar</td>
<td>Banco emissor indisponível</td>
<td>Oriente o portador a aguardar alguns instantes e tentar novamente</td>
<td>SIM</td>
</tr>
<tr>
<td>96</td>
<td>Tente novamente</td>
<td>Falha no envio da autorização</td>
<td>Oriente o portador a aguardar alguns instantes e tentar novamente</td>
<td>SIM</td>
</tr>
<tr>
<td>AA</td>
<td>Tempo excedido</td>
<td>Timeout na comunicação com o banco emissor</td>
<td>Oriente o portador a aguardar alguns instantes e tentar novamente</td>
<td>SIM</td>
</tr>
<tr>
<td>AC</td>
<td>Use função débito</td>
<td>Cartão de débito tentando utilizar produto crédito</td>
<td>Oriente o portador a utilizar o cartão de débito (Visa ou MasterCard)</td>
<td>NÃO</td>
</tr>
<tr>
<td>GA</td>
<td>Transação referida pela Cielo</td>
<td>Referida pela Cielo</td>
<td>Oriente o portador a aguardar alguns instantes e tentar novamente</td>
<td>SIM</td>
</tr>
</tbody></table>

<h2 id="códigos-de-erros">Códigos de Erros</h2>

<p>Os erros que podem ser apresentados na mensagem XML, através da TAG <code class="prettyprint">&lt;erro&gt;</code>, estão dispostos a seguir:</p>

<h3 id="tabela-de-erros-de-integração">Tabela de erros de integração</h3>

<table><thead>
<tr>
<th>Código</th>
<th>Mensagem</th>
<th>Descrição</th>
<th>Ação</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>Mensagem inválida</td>
<td>A mensagem XML está fora do formato especificado pelo arquivo ecommerce.xsd</td>
<td>Revisar as informações enviadas na mensagem XML frente às especificações</td>
</tr>
<tr>
<td>2</td>
<td>Credenciais inválidas</td>
<td>Impossibilidade de autenticar uma requisição daloja virtual.</td>
<td>Verificar se o número de credenciamento e a chave estão corretos</td>
</tr>
<tr>
<td>3</td>
<td>Transação inexistente</td>
<td>Não existe transação para o identificador informado</td>
<td>Rever a aplicação</td>
</tr>
<tr>
<td>8</td>
<td>Código de Segurança Inválido</td>
<td>O código de segurança informado na mensagem é inválido.</td>
<td>Revisar as informações de cartão enviadas na mensagem XML</td>
</tr>
<tr>
<td>10</td>
<td>Inconsistência no envio do cartão</td>
<td>A transação, com ou sem cartão, está divergente com a permissão de envio dessa informação</td>
<td>Rever se o cadastro da loja permite o envio do cartão ou não</td>
</tr>
<tr>
<td>11</td>
<td>Modalidade não habilitada</td>
<td>A transação está configurada com uma modalidade de pagamento não habilitada para a loja</td>
<td>Rever a modalidade de pagamento solicitada</td>
</tr>
<tr>
<td>12</td>
<td>Número de parcelas inválido</td>
<td>O número de parcelas solicitado ultrapassa o máximo permitido</td>
<td>Rever a forma de pagamento</td>
</tr>
<tr>
<td>13</td>
<td>Flag de autorização automática</td>
<td>Flag de autorização automática incompatível com a inválida forma de pagamento solicitada</td>
<td>Rever as regras de utilização da flag</td>
</tr>
<tr>
<td>14</td>
<td>Autorização Direta inválida</td>
<td>A solicitação de Autorização Direta está inválida</td>
<td>Rever as regras de utilização da Autorização Direta</td>
</tr>
<tr>
<td>15</td>
<td>Autorização Direta sem Cartão</td>
<td>A solicitação de Autorização Direta está sem cartão</td>
<td>Rever as regras de utilização da Autorização Direta</td>
</tr>
<tr>
<td>16</td>
<td>Identificador, TID, inválido</td>
<td>O TID fornecido está duplicado</td>
<td>Rever a aplicação</td>
</tr>
<tr>
<td>17</td>
<td>Código de segurança ausente</td>
<td>O código de segurança do cartão não foi enviado (essa informação é sempre obrigatória para Amex)</td>
<td>Rever a aplicação</td>
</tr>
<tr>
<td>18</td>
<td>Indicador de código de segurança inconsistente</td>
<td>Uso incorreto do indicador de código de segurança</td>
<td>Revisar as informações de cartão enviadas na mensagem XML</td>
</tr>
<tr>
<td>19</td>
<td>URL de Retorno não fornecida</td>
<td>A URL de Retorno é obrigatória, exceto para recorrência e autorização direta.</td>
<td>Revisar as informações enviadas na mensagem XML</td>
</tr>
<tr>
<td>20</td>
<td>Status não permite autorização</td>
<td>Não é permitido realizar autorização para o status da transação</td>
<td>Rever as regras de autorização</td>
</tr>
<tr>
<td>21</td>
<td>Prazo de autorização vencido</td>
<td>Não é permitido realizar autorização, pois o prazo está vencido</td>
<td>Rever as regras de autorização</td>
</tr>
<tr>
<td>22</td>
<td>Número de parcelas inválido</td>
<td>Não é permitido realizar autorização para este número de parcelas</td>
<td>Rever as regras de autorização</td>
</tr>
<tr>
<td>25</td>
<td>Encaminhamento a autorização não permitido</td>
<td>O resultado da Autenticação da transação não permite a solicitação de Autorização</td>
<td>Rever as regras de autorização</td>
</tr>
<tr>
<td>30</td>
<td>Status inválido para captura</td>
<td>O status da transação não permite captura</td>
<td>Rever as regras de captura</td>
</tr>
<tr>
<td>31</td>
<td>Prazo de captura vencido</td>
<td>A captura não pode ser realizada, pois o prazo para captura está vencido</td>
<td>Rever as regras de captura</td>
</tr>
<tr>
<td>32</td>
<td>Valor de captura inválido</td>
<td>O valor solicitado para captura não é válido</td>
<td>Rever as regras de captura</td>
</tr>
<tr>
<td>33</td>
<td>Falha ao capturar</td>
<td>Não foi possível realizar a captura</td>
<td>Realizar nova tentativa. Persistindo, entrar em contato com o Suporte E-commerce e informar o TID da transação.</td>
</tr>
<tr>
<td>34</td>
<td>Valor da taxa de embarque obrigatório</td>
<td>O valor da taxa de embarque é obrigatório se a captura for parcial e a autorização tiver sido feita com taxa de embarque.</td>
<td>Envie novamente a requisição de captura com a tag .</td>
</tr>
<tr>
<td>35</td>
<td>Bandeira inválida para utilização da Taxa de Embarque</td>
<td>A bandeira utilizada na transação não tem suporte à taxa de embarque.</td>
<td>Remova a taxa de embarque ou utilize um cartão que suporte esta funcionalidade: Visa ou Mastercard.</td>
</tr>
<tr>
<td>36</td>
<td>Produto inválido para utilização da Taxa de Embarque</td>
<td>O produto escolhido não tem suporte à taxa de embarque.</td>
<td>Altere o produto.</td>
</tr>
<tr>
<td>40</td>
<td>Prazo de cancelamento vencido</td>
<td>O cancelamento não pode ser realizado, pois o prazo está vencido</td>
<td>Rever as regras de cancelamento.</td>
</tr>
<tr>
<td>42</td>
<td>Falha ao cancelar</td>
<td>Não foi possível realizar o cancelamento</td>
<td>Realizar nova tentativa. Persistindo, entrar em contato com o Suporte E-commerce e informar o TID da transação.</td>
</tr>
<tr>
<td>43</td>
<td>Valor de cancelamento é maior que valor autorizado.</td>
<td>O valor que está tentando cancelar supera o valor total capturado da transação.</td>
<td>Revisar o valor do cancelamento parcial, pois não pode ser maior que o valor capturado da transação.</td>
</tr>
<tr>
<td>51</td>
<td>Recorrência Inválida</td>
<td>As configurações da transação não permitem que a transação recorrente seja efetuada com sucesso.</td>
<td>Verifique se escolheu “Crédito à vista”; Verifique se está enviando somente o token ou somente o cartão de crédito</td>
</tr>
<tr>
<td>52</td>
<td>Token Inválido</td>
<td>O token fornecido na requisição de autorização não é válido ou está bloqueado.</td>
<td>Verifique se o Token está correto. Persistindo, entrar em contato com o Suporte.</td>
</tr>
<tr>
<td>53</td>
<td>Recorrência não habilitada</td>
<td>O cadastro do lojista não permite o envio de transações recorrentes.</td>
<td>Entre em contato com suporte para saber como habilitar a recorrência no cadastro.</td>
</tr>
<tr>
<td>54</td>
<td>Transação com Token inválida</td>
<td>As configurações da transação não permitem que a autorização direta com uso de Token seja efetuada com sucesso.</td>
<td>Verifique se escolheu “Crédito à vista”; Verifique se está enviando somente o token ou somente o cartão de crédito.</td>
</tr>
<tr>
<td>55</td>
<td>Número do cartão não fornecido</td>
<td>Foi solicitado criação de Token, porém o número do cartão de crédito não foi fornecido.</td>
<td>Revisar as informações enviadas na mensagem XML frente às especificações</td>
</tr>
<tr>
<td>56</td>
<td>Validade do cartão não fornecido</td>
<td>Foi solicitado criação de Token, porém a validade do cartão de crédito não foi fornecida.</td>
<td>Revisar as informações enviadas na mensagem XML frente às especificações.</td>
</tr>
<tr>
<td>57</td>
<td>Erro inesperado gerando Token</td>
<td>Falha no sistema ocorrida no momento da geração do Token.</td>
<td>Tentar novamente. Persistindo, entrar em contato com o Suporte.</td>
</tr>
<tr>
<td>61</td>
<td>Transação Recorrente Inválida</td>
<td>As configurações da transação recorrente estão inválidas.</td>
<td>Verifique se o produto é Crédito à vista, se o token ou o cartão foram enviados na mensagem.</td>
</tr>
<tr>
<td>77</td>
<td>XID não fornecido</td>
<td>Foi solicitado uma autorização com autenticação externa, porém o campo XID não foi fornecido.</td>
<td>Revisar as informações enviadas na mensagem XML frente às especificações.</td>
</tr>
<tr>
<td>78</td>
<td>CAVV não fornecido</td>
<td>Foi solicitado uma autorização com autenticação externa, porém o campo CAVV não foi fornecido.</td>
<td>Revisar as informações enviadas na mensagem XML frente às especificações.</td>
</tr>
<tr>
<td>86</td>
<td>XID e CAVV não fornecidos</td>
<td>Foi solicitado uma autorização com autenticação externa, porém os campos CAVV e XID não foram fornecidos.</td>
<td>Revisar as informações enviadas na mensagem XML frente às especificações.</td>
</tr>
<tr>
<td>87</td>
<td>CAVV com tamanho divergente</td>
<td>Foi solicitado uma autorização com autenticação externa, porém o campo CAVV possue um tamanho divergente.</td>
<td>Revisar as informações enviadas na mensagem XML frente às especificações.</td>
</tr>
<tr>
<td>88</td>
<td>XID com tamanho divergente</td>
<td>Foi solicitado uma autorização com autenticação externa, porém o campo XID possue um tamanho divergente.</td>
<td>Revisar as informações enviadas na mensagem XML frente às especificações.</td>
</tr>
<tr>
<td>89</td>
<td>ECI com tamanho divergente</td>
<td>Foi solicitado uma autorização com autenticação externa, porém o campo ECI possue um tamanho divergente.</td>
<td>Revisar as informações enviadas na mensagem XML frente às especificações.</td>
</tr>
<tr>
<td>90</td>
<td>ECI inválido</td>
<td>Foi solicitado uma autorização com autenticação externa, porém o campo ECI possue um valor inválido.</td>
<td>Revisar as informações enviadas na mensagem XML frente às especificações.</td>
</tr>
<tr>
<td>95</td>
<td>Erro interno de autenticação</td>
<td>Falha no sistema</td>
<td>Persistindo, entrar em contato com o Suporte e informar o TID da transação.</td>
</tr>
<tr>
<td>97</td>
<td>Sistema indisponível</td>
<td>Falha no sistema</td>
<td>Persistindo, entrar em contato com o Suporte.</td>
</tr>
<tr>
<td>98</td>
<td>Timeout</td>
<td>A aplicação não respondeu dentro de 25 segundos</td>
<td>Persistindo, entrar em contato com o Suporte.</td>
</tr>
<tr>
<td>99</td>
<td>Erro inesperado</td>
<td>Falha no sistema</td>
<td>Persistindo, entrar em contato com o Suporte e informar o TID da transação.</td>
</tr>
</tbody></table>

<h2 id="status-das-transações">Status das transações</h2>

<table><thead>
<tr>
<th>Status</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>Transação Criada</td>
<td>0</td>
</tr>
<tr>
<td>Transação em Andamento</td>
<td>1</td>
</tr>
<tr>
<td>Transação Autenticada</td>
<td>2</td>
</tr>
<tr>
<td>Transação não Autenticada</td>
<td>3</td>
</tr>
<tr>
<td>Transação Autorizada</td>
<td>4</td>
</tr>
<tr>
<td>Transação não Autorizada</td>
<td>5</td>
</tr>
<tr>
<td>Transação Capturada</td>
<td>6</td>
</tr>
<tr>
<td>Transação Cancelada</td>
<td>9</td>
</tr>
<tr>
<td>Transação em Autenticação</td>
<td>10</td>
</tr>
<tr>
<td>Transação em Cancelamento</td>
<td>12</td>
</tr>
</tbody></table>

<h2 id="eci">ECI</h2>

<table><thead>
<tr>
<th>Resultado da Autenticação</th>
<th>Visa</th>
<th>Mastercard</th>
<th>Aura</th>
<th>Demais</th>
</tr>
</thead><tbody>
<tr>
<td>Portador autenticado com sucesso.</td>
<td>5</td>
<td>2</td>
<td>n/d</td>
<td>n/d</td>
</tr>
<tr>
<td>Portador não fez autenticação, pois o emissor não forneceu mecanismos de autenticação.</td>
<td>6</td>
<td>1</td>
<td>n/d</td>
<td>n/d</td>
</tr>
<tr>
<td>Portador não se autenticou com sucesso, pois ocorreu um erro técnico inesperado.</td>
<td>7</td>
<td>1</td>
<td>n/d</td>
<td>n/d</td>
</tr>
<tr>
<td>Portador não se autenticou com sucesso.</td>
<td>7</td>
<td>0</td>
<td>n/d</td>
<td>n/d</td>
</tr>
<tr>
<td>A loja optou por autorizar sem passar pela autenticação.</td>
<td>7</td>
<td>0</td>
<td>0</td>
<td>7</td>
</tr>
</tbody></table>

<h1 id="operações-e-configurações">Operações e configurações</h1>

<h2 id="criação-da-transação-de-autorização">Criação da Transação de Autorização</h2>

<p>A requisição de autorização é a principal operação do Cielo E-commerce, pois é através dela que uma venda pode ser concretizada e finalizar o processo de venda. A autorização possui uma série de configurações que podem ser customizadas, além de funcionalidades que agregam valor ao lojista e seus consumidores.</p>

<aside class="notice">Para os códigos de resposta da autorização consulte o Catálogo de Códigos de Resposta da Autorização (LR)</aside>

<aside class="notice">Todas as mensagens devem estar formatadas corretamente segundo especificado no <a href="attachment/ecommerce.xsd">XML Schema ecommerce.xsd</a></aside>

<h2 id="autorização-direta">Autorização Direta</h2>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dados-ec&gt;</span>
    <span class="nt">&lt;numero&gt;</span>1006993069<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;chave&gt;</span>25fbb997438630f30b112d033ce2e621b34f3<span class="nt">&lt;/chave&gt;</span>
  <span class="nt">&lt;/dados-ec&gt;</span>
  <span class="nt">&lt;dados-portador&gt;</span>
    <span class="nt">&lt;numero&gt;</span>4012001038443335<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;validade&gt;</span>201508<span class="nt">&lt;/validade&gt;</span>
    <span class="nt">&lt;indicador&gt;</span>1<span class="nt">&lt;/indicador&gt;</span>
    <span class="nt">&lt;codigo-seguranca&gt;</span>973<span class="nt">&lt;/codigo-seguranca&gt;</span>
  <span class="nt">&lt;/dados-portador&gt;</span>
  <span class="nt">&lt;dados-pedido&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/dados-pedido&gt;</span>
  <span class="nt">&lt;forma-pagamento&gt;</span>
    <span class="nt">&lt;bandeira&gt;</span>visa<span class="nt">&lt;/bandeira&gt;</span>
    <span class="nt">&lt;produto&gt;</span>1<span class="nt">&lt;/produto&gt;</span>
    <span class="nt">&lt;parcelas&gt;</span>1<span class="nt">&lt;/parcelas&gt;</span>
  <span class="nt">&lt;/forma-pagamento&gt;</span>
  <span class="nt">&lt;url-retorno&gt;</span>http://localhost/lojaexemplo/retorno.jsp<span class="nt">&lt;/url-retorno&gt;</span>
  <span class="nt">&lt;autorizar&gt;</span>3<span class="nt">&lt;/autorizar&gt;</span>
  <span class="nt">&lt;capturar&gt;</span>false<span class="nt">&lt;/capturar&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>
</code></pre>

<p>A autorização direta caracteriza-se por ser uma transação onde não há a autenticação do portador, seja por opção (e risco) do lojista, seja porque a bandeira ou emissor não tem suporte. A autorização direta pode ser feita de duas formas: tradicional (com os dados do cartão) ou através de um token.</p>

<h3 id="tradicional">Tradicional</h3>

<ul>
<li><strong>Objetivo</strong> - Submeter uma transação direta com o uso de um cartão de crédito.</li>
<li><strong>Regras</strong>

<ul>
<li>O cadastro da loja virtual deve estar habilitado para envio dos dados do cartão.</li>
<li>Enviar a TAG <code class="prettyprint">&lt;autorizar&gt;</code> com o valor “3”.</li>
<li>Somente válido para Crédito.</li>
<li>O lojista deve estar atento às regras para envio do cartão.</li>
<li>Na autorização direta, o nível de segurança da transação (ECI) é definido como:</li>
<li>“7” para Visa, Diners, Discover, Elo e JCB.</li>
<li>“0” para Mastercard e Aura</li>
</ul></li>
</ul>

<h2 id="autorização-recorrente">Autorização Recorrente</h2>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dados-ec&gt;</span>
    <span class="nt">&lt;numero&gt;</span>1006993069<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;chave&gt;</span>25fbb997438630f30b112d033ce2e621b34f3<span class="nt">&lt;/chave&gt;</span>
  <span class="nt">&lt;/dados-ec&gt;</span>
  <span class="nt">&lt;dados-portador&gt;</span>
    <span class="nt">&lt;numero&gt;</span>4012001038443335<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;validade&gt;</span>201508<span class="nt">&lt;/validade&gt;</span>
    <span class="nt">&lt;indicador&gt;</span>1<span class="nt">&lt;/indicador&gt;</span>
    <span class="nt">&lt;codigo-seguranca&gt;</span>973<span class="nt">&lt;/codigo-seguranca&gt;</span>
  <span class="nt">&lt;/dados-portador&gt;</span>
  <span class="nt">&lt;dados-pedido&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/dados-pedido&gt;</span>
  <span class="nt">&lt;forma-pagamento&gt;</span>
    <span class="nt">&lt;bandeira&gt;</span>visa<span class="nt">&lt;/bandeira&gt;</span>
    <span class="nt">&lt;produto&gt;</span>1<span class="nt">&lt;/produto&gt;</span>
    <span class="nt">&lt;parcelas&gt;</span>1<span class="nt">&lt;/parcelas&gt;</span>
  <span class="nt">&lt;/forma-pagamento&gt;</span>
  <span class="nt">&lt;url-retorno&gt;</span>http://localhost/lojaexemplo/retorno.jsp<span class="nt">&lt;/url-retorno&gt;</span>
  <span class="nt">&lt;autorizar&gt;</span>4<span class="nt">&lt;/autorizar&gt;</span>
  <span class="nt">&lt;capturar&gt;</span>false<span class="nt">&lt;/capturar&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>
</code></pre>

<p>A autorização recorrente pode ser feita de duas formas: através do envio de um token previamente cadastrado, ou através de um cartão. A transação recorrente é praticamente igual à transação tradicional, as mudanças consistem nas regras que o emissor e a bandeira utilizam para autorizar ou negar uma transação. Outra diferença está relacionada ao Renova Fácil.</p>

<aside class="notice">Para saber se sua loja é elegível a utilizar a autorização recorrente, consulte nossa central de relacionamento ou o Suporte Web Cielo E-commerce.</aside>

<aside class="notice">Todas as mensagens devem estar formatadas corretamente segundo especificado no <a href="attachment/ecommerce.xsd">XML Schema ecommerce.xsd</a></aside>

<h3 id="autorização-recorrente-com-cartão">Autorização recorrente com Cartão</h3>

<ul>
<li><strong>Objetivo</strong> - Submeter uma transação recorrente com o uso de um cartão de crédito.</li>
<li><strong>Regras</strong>

<ul>
<li>Enviar a TAG <code class="prettyprint">&lt;autorizar&gt;</code> com o valor “4”.</li>
<li>Somente válido para crédito à vista.</li>
</ul></li>
</ul>

<h3 id="renova-fácil">Renova Fácil</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;transacao</span> <span class="na">xmlns=</span><span class="s">"http://ecommerce.cbmp.com.br"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span> <span class="na">id=</span><span class="s">"d35b67189442"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;tid&gt;</span>10069930690362461001<span class="nt">&lt;/tid&gt;</span>
  <span class="nt">&lt;pan&gt;</span>uv9yI5tkhX9jpuCt+dfrtoSVM4U3gIjvrcwMBfZcadE=<span class="nt">&lt;/pan&gt;</span>
  <span class="nt">&lt;dados-pedido&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/dados-pedido&gt;</span>
  <span class="nt">&lt;forma-pagamento&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/forma-pagamento&gt;</span>
  <span class="nt">&lt;status&gt;</span>5<span class="nt">&lt;/status&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;autorizacao&gt;</span>
    <span class="nt">&lt;codigo&gt;</span>5<span class="nt">&lt;/codigo&gt;</span>
    <span class="nt">&lt;mensagem&gt;</span>Autorização negada<span class="nt">&lt;/mensagem&gt;</span>
    <span class="nt">&lt;data-hora&gt;</span>2011-12-09T10:58:45.847-02:00<span class="nt">&lt;/data-hora&gt;</span>
    <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
    <span class="nt">&lt;lr&gt;</span>57<span class="nt">&lt;/lr&gt;</span>
    <span class="nt">&lt;nsu&gt;</span>221766<span class="nt">&lt;/nsu&gt;</span>
  <span class="nt">&lt;/autorizacao&gt;</span>
  <span class="nt">&lt;dados-portador&gt;</span>
    <span class="nt">&lt;numero&gt;</span>4012001038443335<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;validade&gt;</span>201508<span class="nt">&lt;/validade&gt;</span>
    <span class="nt">&lt;codigo-seguranca/&gt;</span>
  <span class="nt">&lt;/dados-portador&gt;</span>
<span class="nt">&lt;/transacao&gt;</span>
</code></pre>

<p>Essa funcionalidade facilita a identificação de um cartão que tenha sido substituído por outro no banco emissor. Dessa forma, quando uma transação recorrente é submetida ao Web Service e a Cielo identifica que o cartão utilizado está desatualizado, o sistema terá o seguinte comportamento:</p>

<ol>
<li>Caso a transação recorrente tenha sido enviada através de um cartão, sua autorização será negada e serão retornados os dados do novo cartão, conforme o diagrama abaixo:</li>
</ol>

<p><img alt="remova fácil" src="images/remova-facil.png" /></p>

<aside class="notice">O Renova Fácil só está disponível para transações recorrentes. A efetividade do Renova Fácil depende do uso correto das transações recorrentes devidamente sinalizadas como tal. Consulte os bancos e bandeiras participantes com o Suporte Web Cielo E-commerce.</aside>

<aside class="notice">Todas as mensagens devem estar formatadas corretamente segundo especificado no <a href="attachment/ecommerce.xsd">XML Schema ecommerce.xsd</a></aside>

<h3 id="autorização-de-uma-transação-previamente-gerada">Autorização de uma transação previamente gerada</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-autorizacao-tid</span> <span class="na">id=</span><span class="s">"a387cb68-b33a-4113-b7c4-9b7dfde871ec"</span> <span class="na">versao=</span><span class="s">"1.3.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tid&gt;</span>100699306908642E1001<span class="nt">&lt;/tid&gt;</span>
    <span class="nt">&lt;dados-ec&gt;</span>
        <span class="nt">&lt;numero&gt;</span>1006993069<span class="nt">&lt;/numero&gt;</span>
        <span class="nt">&lt;chave&gt;</span>25fbb99741c739dd84d7b06ec78c9bac718838630f30b112d033ce2e621b34f3<span class="nt">&lt;/chave&gt;</span>
    <span class="nt">&lt;/dados-ec&gt;</span>
<span class="nt">&lt;/requisicao-autorizacao-tid&gt;</span>
</code></pre>

<p>Para os estabelecimentos utilizando o processo de autenticação, é possível solicitar a autorização
das transações que pararam após a execução deste processo. A mensagem para performar tal operação
é a “requisicao-autorizacao-tid” como descrita abaixo:</p>

<aside class="notice">Requisições para transações que não foram submetidas ao processo de autenticação ou foram interrompidas, pois o portador errou a senha não serão aceitas.</aside>

<aside class="notice">Todas as mensagens devem estar formatadas corretamente segundo especificado no <a href="attachment/ecommerce.xsd">XML Schema ecommerce.xsd</a></aside>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>tid</td>
<td>Alfanumérico</td>
<td>Sim</td>
<td>20</td>
<td>Identificador da transação</td>
</tr>
<tr>
<td>dados-ec.numero</td>
<td>Numérico</td>
<td>Sim</td>
<td>1..20</td>
<td>Número de afiliação da loja com a Cielo.</td>
</tr>
<tr>
<td>dados-ec.chave</td>
<td>Alfanumérico</td>
<td>Sim</td>
<td>1..100</td>
<td>Chave de acesso da loja atribuída pela Cielo.</td>
</tr>
</tbody></table>

<h2 id="transação-com-token">Transação com Token</h2>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-token</span> <span class="na">id=</span><span class="s">"8fc889c7-004f-42f1-963a-31aa26f75e5c"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dados-ec&gt;</span>
    <span class="nt">&lt;numero&gt;</span>1006993069<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;chave&gt;</span>25fbb99741c739dd84d7b06ec78c9bac718838630f30b112d033ce2e621b34f3<span class="nt">&lt;/chave&gt;</span>
  <span class="nt">&lt;/dados-ec&gt;</span>
  <span class="nt">&lt;dados-portador&gt;</span>
    <span class="nt">&lt;numero&gt;</span>4012001038443335<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;validade&gt;</span>201508<span class="nt">&lt;/validade&gt;</span>
    <span class="nt">&lt;nome-portador&gt;</span>FULANO DA SILVA<span class="nt">&lt;/nome-portador&gt;</span>
  <span class="nt">&lt;/dados-portador&gt;</span>
<span class="nt">&lt;/requisicao-token&gt;</span>
</code></pre>

<ul>
<li><strong>Objetivo</strong> - Solicitar a criação de um token associada a um cartão de crédito, para viabilizar o envio de transações sem o cartão.</li>
<li><strong>Regras</strong>

<ul>
<li>O Token é único para um determinado [Cartão + Estabelecimento Comercial]. Dessa forma, um cartão pode estar “tokenizado” em mais de uma loja e em cada uma possuirá códigos diferentes.</li>
<li>Caso seja enviada mais de uma solicitação com os mesmos dados, o token retornado será sempre o mesmo.</li>
<li>A criação do token é independente do resultado da autorização (aprovada/negada).</li>
</ul></li>
</ul>

<aside class="warning">A transação feita via token não isenta o lojista do envio da informação de bandeira, portanto é necessário que o sistema do lojista (ou gateway) que armazenará os tokens também armazene a bandeira do cartão que foi tokenizado.</aside>

<aside class="notice">Um token não utilizado por mais de um ano será automaticamente removido do banco de dados da Cielo. É possível realizar o bloqueio de um token específico para que este não seja mais usado. O bloqueio do token deve ser solicitado ao Suporte Web Cielo E-commerce.</aside>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>dados-ec.numero</td>
<td>Numérico</td>
<td>Sim</td>
<td>1..20</td>
<td>Número de afiliação da loja com a Cielo.</td>
</tr>
<tr>
<td>dados-ec.chave</td>
<td>Alfanumérico</td>
<td>Sim</td>
<td>1..100</td>
<td>Chave de acesso da loja atribuída pela Cielo.</td>
</tr>
<tr>
<td>daods-portador</td>
<td>n/a</td>
<td>Opcional</td>
<td>n/a</td>
<td>Nó com os dados do cartão.</td>
</tr>
<tr>
<td>dados-portador.numero</td>
<td>Numérico</td>
<td>Sim</td>
<td>19</td>
<td>Número do cartão</td>
</tr>
<tr>
<td>dados-portador.validade</td>
<td>Numérico</td>
<td>Sim</td>
<td>6</td>
<td>Validade do cartão no formato aaaamm. Exemplo: 201212 (dez/2012).</td>
</tr>
<tr>
<td>dados-portador.nome-portador</td>
<td>Alfanumérico</td>
<td>Opcional</td>
<td>0..50</td>
<td>Nome impresso no cartão</td>
</tr>
</tbody></table>

<h3 id="retorno">Retorno</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;retorno-token</span> <span class="na">xmlns=</span><span class="s">"http://ecommerce.cbmp.com.br"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span> <span class="na">id=</span><span class="s">"57239017"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;token&gt;</span>
    <span class="nt">&lt;dados-token&gt;</span>
      <span class="nt">&lt;codigo-token&gt;</span>TuS6LeBHWjqFFtE7S3zR052Jl/KUlD+tYJFpAdlA87E=<span class="nt">&lt;/codigo-token&gt;</span>
      <span class="nt">&lt;status&gt;</span>1<span class="nt">&lt;/status&gt;</span>
      <span class="nt">&lt;numero-cartao-truncado&gt;</span>455187******0183<span class="nt">&lt;/numero-cartao-truncado&gt;</span>
    <span class="nt">&lt;/dados-token&gt;</span>
  <span class="nt">&lt;/token&gt;</span>
<span class="nt">&lt;/retorno-token&gt;</span>
</code></pre>

<p>O retorno será do tipo <retorno-token> quando a solicitação tenha sido concluída com sucesso, ou <erro> em caso de fracasso.</p>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>codigo-token</td>
<td>Alfanumérico</td>
<td>100</td>
<td>Código do token gerado</td>
</tr>
<tr>
<td>status</td>
<td>Numérico</td>
<td>1</td>
<td>Status do Token: <strong>0</strong> – Bloqueado, <strong>1</strong> – Desbloqueado</td>
</tr>
<tr>
<td>numero-cartao-truncado</td>
<td>Alfanumérico</td>
<td>1..16</td>
<td>Número do cartão truncado.</td>
</tr>
</tbody></table>

<h3 id="autorização-direta-via-token">Autorização Direta via Token</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dados-ec&gt;</span>
    <span class="nt">&lt;numero&gt;</span>1006993069<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;chave&gt;</span>25fbb997438630f30b112d033ce2e621b34f3<span class="nt">&lt;/chave&gt;</span>
  <span class="nt">&lt;/dados-ec&gt;</span>
  <span class="nt">&lt;dados-portador&gt;</span>
    <span class="nt">&lt;token&gt;</span>TuS6LeBHWjqFFtE7S3zR052Jl/KUlD+tYJFpAdlA87E=<span class="nt">&lt;/token&gt;</span>
  <span class="nt">&lt;/dados-portador&gt;</span>
  <span class="nt">&lt;dados-pedido&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/dados-pedido&gt;</span>
  <span class="nt">&lt;forma-pagamento&gt;</span>
    <span class="nt">&lt;bandeira&gt;</span>visa<span class="nt">&lt;/bandeira&gt;</span>
    <span class="nt">&lt;produto&gt;</span>1<span class="nt">&lt;/produto&gt;</span>
    <span class="nt">&lt;parcelas&gt;</span>1<span class="nt">&lt;/parcelas&gt;</span>
  <span class="nt">&lt;/forma-pagamento&gt;</span>
  <span class="nt">&lt;url-retorno&gt;</span>http://localhost/lojaexemplo/retorno.jsp<span class="nt">&lt;/url-retorno&gt;</span>
  <span class="nt">&lt;autorizar&gt;</span>3<span class="nt">&lt;/autorizar&gt;</span>
  <span class="nt">&lt;capturar&gt;</span>true<span class="nt">&lt;/capturar&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>
</code></pre>

<ul>
<li><strong>Objetico</strong> - Submeter uma transação direta (sem autenticação) com o uso de um token previamente cadastrado</li>
<li><strong>Regras</strong>

<ul>
<li>Enviar a TAG <code class="prettyprint">&lt;autorizar&gt;</code> com o valor “3”.</li>
<li>O token deve estar desbloqueado.</li>
<li>Válido somente para crédito.</li>
</ul></li>
</ul>

<h3 id="autorização-recorrente-com-token">Autorização recorrente com Token</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dados-ec&gt;</span>
    <span class="nt">&lt;numero&gt;</span>1006993069<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;chave&gt;</span>25fbb997438630f30b112d033ce2e621b34f3<span class="nt">&lt;/chave&gt;</span>
  <span class="nt">&lt;/dados-ec&gt;</span>
  <span class="nt">&lt;dados-portador&gt;</span>
    <span class="nt">&lt;token&gt;</span>TuS6LeBHWjqFFtE7S3zR052Jl/KUlD+tYJFpAdlA87E=<span class="nt">&lt;/token&gt;</span>
  <span class="nt">&lt;/dados-portador&gt;</span>
  <span class="nt">&lt;dados-pedido&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/dados-pedido&gt;</span>
  <span class="nt">&lt;forma-pagamento&gt;</span>
    <span class="nt">&lt;bandeira&gt;</span>visa<span class="nt">&lt;/bandeira&gt;</span>
    <span class="nt">&lt;produto&gt;</span>1<span class="nt">&lt;/produto&gt;</span>
    <span class="nt">&lt;parcelas&gt;</span>1<span class="nt">&lt;/parcelas&gt;</span>
  <span class="nt">&lt;/forma-pagamento&gt;</span>
  <span class="nt">&lt;url-retorno&gt;</span>http://localhost/lojaexemplo/retorno.jsp<span class="nt">&lt;/url-retorno&gt;</span>
  <span class="nt">&lt;autorizar&gt;</span>4<span class="nt">&lt;/autorizar&gt;</span>
  <span class="nt">&lt;capturar&gt;</span>true<span class="nt">&lt;/capturar&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>

</code></pre>

<ul>
<li><strong>Objetivo</strong> - Submeter uma transação recorrente com o uso de um token previamente cadastrado.</li>
<li><strong>Regras</strong>

<ul>
<li>Enviar a TAG <code class="prettyprint">&lt;autorizar&gt;</code> com o valor “4”.</li>
<li>O token deve estar desbloqueado.</li>
<li>Somente válido para crédito à vista.</li>
</ul></li>
</ul>

<h3 id="renova-fácil-com-token">Renova Fácil com Token</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;transacao</span> <span class="na">xmlns=</span><span class="s">"http://ecommerce.cbmp.com.br"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span> <span class="na">id=</span><span class="s">"d35b67189442"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;tid&gt;</span>10069930690362461001<span class="nt">&lt;/tid&gt;</span>
  <span class="nt">&lt;pan&gt;</span>uv9yI5tkhX9jpuCt+dfrtoSVM4U3gIjvrcwMBfZcadE=<span class="nt">&lt;/pan&gt;</span>
  <span class="nt">&lt;dados-pedido&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/dados-pedido&gt;</span>
  <span class="nt">&lt;forma-pagamento&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/forma-pagamento&gt;</span>
  <span class="nt">&lt;status&gt;</span>5<span class="nt">&lt;/status&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;autorizacao&gt;</span>
    <span class="nt">&lt;codigo&gt;</span>5<span class="nt">&lt;/codigo&gt;</span>
    <span class="nt">&lt;mensagem&gt;</span>Autorização negada<span class="nt">&lt;/mensagem&gt;</span>
    <span class="nt">&lt;data-hora&gt;</span>2011-12-09T10:58:45.847-02:00<span class="nt">&lt;/data-hora&gt;</span>
    <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
    <span class="nt">&lt;lr&gt;</span>57<span class="nt">&lt;/lr&gt;</span>
    <span class="nt">&lt;nsu&gt;</span>221766<span class="nt">&lt;/nsu&gt;</span>
  <span class="nt">&lt;/autorizacao&gt;</span>
  <span class="nt">&lt;token&gt;</span>
    <span class="nt">&lt;dados-token&gt;</span>
      <span class="nt">&lt;codigo-token&gt;</span>TuS6LeBHWjqFFtE7S3zR052Jl/KUlD+tYJFpAdlA87E=<span class="nt">&lt;/codigo-token&gt;</span>
      <span class="nt">&lt;status&gt;</span>1<span class="nt">&lt;/status&gt;</span>
      <span class="nt">&lt;numero-cartao-truncado&gt;</span>455187******0183<span class="nt">&lt;/numero-cartao-truncado&gt;</span>
    <span class="nt">&lt;/dados-token&gt;</span>
  <span class="nt">&lt;/token&gt;</span>
<span class="nt">&lt;/transacao&gt;</span>
</code></pre>

<p>Essa funcionalidade facilita a identificação de um cartão que tenha sido substituído por outro no banco emissor. Dessa forma, quando uma transação recorrente é submetida ao Web Service e a Cielo identifica que o cartão utilizado está desatualizado, o sistema terá o seguinte comportamento:</p>

<ol>
<li>Caso a transação recorrente tenha sido enviada através de um token, sua autorização será negada e será retornado um novo token para ser utilizado, conforme o diagrama abaixo:</li>
</ol>

<p><img alt="remova fácil com token" src="images/remova-facil-token.png" /></p>

<h3 id="geração-de-token">Geração de Token</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.0"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;gerar-token&gt;</span>true<span class="nt">&lt;/gerar-token&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>
</code></pre>

<aside class="warning">este serviço adicional está sujeito a cobrança a partir do momento em que a geração de token é solicitada.</aside>

<ul>
<li><strong>Objetivo</strong> - Além da mensagem específica para criação de um token, descrita em Transação com Token, é possível aproveitar uma requisição de autorização para solicitar a geração do token, acrescentando a informação <code class="prettyprint">&lt;gerar-token&gt;</code> no nó de requisição de transação.</li>
<li><strong>Regras</strong>

<ul>
<li>Caso um cartão seja submetido mais de uma vez pelo mesmo lojista, o Token gerado será sempre o mesmo.</li>
</ul></li>
</ul>

<h2 id="funcionalidades-agregadas">Funcionalidades Agregadas</h2>

<h3 id="autenticação-e-transações-com-cartões-de-débito">Autenticação e Transações com Cartões de Débito</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;forma-pagamento&gt;</span>
    <span class="nt">&lt;bandeira&gt;</span>visa<span class="nt">&lt;/bandeira&gt;</span>
    <span class="nt">&lt;produto&gt;</span>A<span class="nt">&lt;/produto&gt;</span>
    <span class="nt">&lt;parcelas&gt;</span>1<span class="nt">&lt;/parcelas&gt;</span>
  <span class="nt">&lt;/forma-pagamento&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;autorizar&gt;</span>1<span class="nt">&lt;/autorizar&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>
</code></pre>

<p>A autenticação da transação garantirá uma segurança extra ao lojista contra Chargebacks, porém, conforme apresentando no capítulo “2.5 – Autenticação e nível de segurança”, nem todas as bandeiras e emissores disponibilizam esse tipo de serviço.</p>

<p>O produto débito obrigatoriamente exige uma transação autenticada, caso contrário, a transação não é autorizada.</p>

<ul>
<li><strong>Objetivo</strong> - Tornar elegível uma transação para autenticação.</li>
<li><strong>Regras</strong>

<ul>
<li>Enviar a flag <autorizar> de acordo com o domínio abaixo, para tentar:</li>
<li>0 – Somente autenticar a transação.</li>
<li>1 – Submeter à autorização somente se a transação for autenticada.</li>
<li>2 – Submeter à autorização se a transação for autenticada ou não.</li>
<li>Para débito, enviar o produto “A” no XML.</li>
<li>A solicitação da autorização de uma transação que foi somente autenticada pode ser feita em até 90 dias após a data inicial.</li>
</ul></li>
</ul>

<aside class="notice">Tendo em vista que a autenticação não depende exclusivamente desta flag, recomendamos sempre verificar o campo <eci> para verificar o resultado da autenticação.</aside>

<h3 id="soft-descriptor">Soft Descriptor</h3>
<pre><code class="highlight xml"><span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;dados-pedido&gt;</span>
    <span class="nt">&lt;numero&gt;</span>178148599<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
    <span class="nt">&lt;moeda&gt;</span>986<span class="nt">&lt;/moeda&gt;</span>
    <span class="nt">&lt;data-hora&gt;</span>2011-12-07T11:43:37<span class="nt">&lt;/data-hora&gt;</span>
    <span class="nt">&lt;descricao&gt;</span>[origem:10.50.54.156]<span class="nt">&lt;/descricao&gt;</span>
    <span class="nt">&lt;idioma&gt;</span>PT<span class="nt">&lt;/idioma&gt;</span>
    <span class="nt">&lt;soft-descriptor&gt;</span>soft-descriptor<span class="nt">&lt;/soft-descriptor&gt;</span>
  <span class="nt">&lt;/dados-pedido&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>
</code></pre>

<ul>
<li><strong>Objetivo</strong> - Permite que o lojista envie um texto de até 13 caracteres que será impresso na fatura do portador, ao lado da identificação da loja, respeitando o comprimento das bandeiras:

<ul>
<li><strong>Visa</strong>: 25 caracteres</li>
<li><strong>Mastercard</strong>: 22 caracteres</li>
</ul></li>
<li><strong>Regras</strong>

<ul>
<li>Tamanho máximo: 13 caracteres.</li>
<li>Disponível apenas para as bandeiras Visa e MasterCard.</li>
<li>Uso exclusivo de caracteres simples.</li>
</ul></li>
</ul>

<aside class="notice">Para conhecer e/ou alterar o nome da loja que será impresso na fatura do portador entre em contato com nossa central de relacionamento</aside>

<h3 id="captura-automática">Captura Automática</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;capturar&gt;</span>true<span class="nt">&lt;/capturar&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>
</code></pre>

<ul>
<li><strong>Objetivo</strong> - A captura automática permite que uma requisição de autorização seja capturada imediatamente após sua aprovação. Dessa forma, não é preciso realizar uma <code class="prettyprint">&lt;requisicao-captura&gt;</code>.</li>
<li><strong>Regras</strong>

<ul>
<li>Somente autorizações aprovadas serão capturadas automaticamente.</li>
</ul></li>
</ul>

<h3 id="taxa-de-embarque">Taxa de embarque</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;dados-pedido&gt;</span>
    <span class="nt">&lt;numero&gt;</span>178148599<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;valor&gt;</span>10000<span class="nt">&lt;/valor&gt;</span>
    <span class="nt">&lt;moeda&gt;</span>986<span class="nt">&lt;/moeda&gt;</span>
    <span class="nt">&lt;data-hora&gt;</span>2011-12-07T11:43:37<span class="nt">&lt;/data-hora&gt;</span>
    <span class="nt">&lt;descricao&gt;</span>[origem:10.50.54.156]<span class="nt">&lt;/descricao&gt;</span>
    <span class="nt">&lt;idioma&gt;</span>PT<span class="nt">&lt;/idioma&gt;</span>
    <span class="nt">&lt;soft-descriptor&gt;</span>softdescriptor<span class="nt">&lt;/soft-descriptor&gt;</span>
    <span class="nt">&lt;taxa-embarque&gt;</span>1000<span class="nt">&lt;/taxa-embarque&gt;</span>
  <span class="nt">&lt;/dados-pedido&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>
</code></pre>

<ul>
<li><strong>Objetivo</strong> A taxa de embarque é um campo informativo que define o montante do total da transação (informado na tag dados-pedido//valor) que deve ser destinado ao pagamento da taxa à Infraero.

<ul>
<li>O valor da taxa de embarque não é acumulado ao valor da autorização. Por exemplo, em uma venda de passagem aérea de R$ 200,00 com taxa de embarque de R$ 25,00 deve-se enviar o campo <code class="prettyprint">&lt;valor&gt;22500&lt;/valor&gt;</code> e <code class="prettyprint">&lt;taxa-embarque&gt;2500&lt;/taxa-embarque&gt;</code>.</li>
</ul></li>
<li><strong>Regras</strong>

<ul>
<li>Disponível apenas para as bandeiras Visa e Mastercard.</li>
<li>O valor da taxa de embarque não é somado ao valor da autorização, ou seja, é apenas informativo.</li>
</ul></li>
</ul>

<aside class="notice">Existem regras específicas para a requisição de captura com taxa de embarque, disponíveis no item Captura Total e Parcial.</aside>

<h3 id="avs-(address-verification-service)">AVS (Address Verification Service)</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-transacao</span> <span class="na">id=</span><span class="s">"a97ab62a-7956-41ea-b03f-c2e9f612c293"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;dados-pedido&gt;</span>
    <span class="nt">&lt;numero&gt;</span>178148599<span class="nt">&lt;/numero&gt;</span>
    <span class="nt">&lt;valor&gt;</span>10000<span class="nt">&lt;/valor&gt;</span>
    <span class="nt">&lt;moeda&gt;</span>986<span class="nt">&lt;/moeda&gt;</span>
    <span class="nt">&lt;data-hora&gt;</span>2011-12-07T11:43:37<span class="nt">&lt;/data-hora&gt;</span>
    <span class="nt">&lt;descricao&gt;</span>[origem:10.50.54.156]<span class="nt">&lt;/descricao&gt;</span>
    <span class="nt">&lt;idioma&gt;</span>PT<span class="nt">&lt;/idioma&gt;</span>
    <span class="nt">&lt;soft-descriptor&gt;</span>softdescriptor<span class="nt">&lt;/soft-descriptor&gt;</span>
    <span class="nt">&lt;taxa-embarque&gt;</span>1000<span class="nt">&lt;/taxa-embarque&gt;</span>
    <span class="nt">&lt;avs&gt;</span>
    <span class="cp">&lt;![CDATA[
      &lt;dados-avs&gt;</span>
        <span class="nt">&lt;endereco&gt;</span>Rua Teste AVS<span class="nt">&lt;/endereco&gt;</span>
        <span class="nt">&lt;complemento&gt;</span>Casa<span class="nt">&lt;/complemento&gt;</span>
        <span class="nt">&lt;numero&gt;</span>123<span class="nt">&lt;/numero&gt;</span>
        <span class="nt">&lt;bairro&gt;</span>Vila AVS<span class="nt">&lt;/bairro&gt;</span>
        <span class="nt">&lt;cep&gt;</span>12345-123<span class="nt">&lt;/cep&gt;</span>
      <span class="nt">&lt;/dados-avs&gt;</span>
    ]]&gt;
    <span class="nt">&lt;/avs&gt;</span>
  <span class="nt">&lt;/dados-pedido&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/requisicao-transacao&gt;</span>
</code></pre>

<ul>
<li><strong>Objetivo</strong> - O AVS é um serviço para transações de cartão não presente onde é realizada uma validação cadastral através do batimento dos dados numéricos do endereço informado pelo portador (endereço de entrega da fatura) na loja virtual, com os dados cadastrais do emissor.

<ul>
<li>O AVS é um serviço que auxilia na redução do risco de não reconhecimento de compras online. É uma ferramenta que o estabelecimento utilizará para a análise de suas vendas, antes de decidir pela captura da transação e a entrega do produto ou serviço.</li>
</ul></li>
<li><strong>Regras</strong>

<ul>
<li>Disponível apenas para as bandeiras Visa, Mastercard e AmEx.</li>
<li>Produtos permitidos: somente crédito.</li>
<li>O retorno da consulta ao AVS é separado em dois itens: CEP e endereço.</li>
<li>Cada um deles pode ter os seguintes valores:</li>
<li>C – Confere;</li>
<li>N – Não confere;</li>
<li>I – Indisponível;</li>
<li>T – Temporariamente indisponível;</li>
<li>X – Serviço não suportado para esta Bandeira.</li>
<li>O nó contendo o XML do AVS deve estar encapsulado pelo termo “CDATA”, para evitar problemas com o parser da requisição.</li>
<li>É necessário que todos os campos contidos no nó AVS sejam preenchidos.</li>
<li>Necessário habilitar a opção do AVS no cadastro. Para habilitar a opção AVS no cadastro ou consultar os bancos participantes, entre em contato com o Suporte Web Cielo E-commerce.</li>
</ul></li>
</ul>

<aside class="warning">Conforme contrato, este serviço adicional está sujeito a cobrança a partir do momento em que a consulta de AVS for solicitada. Para maiores informações, favor entrar em contato com a central de atendimento, seu gerente de contas ou o Suporte Web Cielo E-commerce.</aside>

<h2 id="captura">Captura</h2>

<p>Uma transação autorizada somente gera o crédito para o estabelecimento comercial caso ela seja capturada. Por isso, <strong>toda venda que o lojista queira efetivar será preciso realizar a captura (ou confirmação) da transação</strong>.</p>

<p>Para vendas na modalidade de Crédito, essa confirmação pode ocorrer em dois momentos:</p>

<ul>
<li>Imediatamente após a autorização (captura total);</li>
<li>Posterior à autorização (captura total ou parcial).</li>
</ul>

<p>No primeiro caso, não é necessário enviar uma requisição de captura, pois ela é feita automaticamente pela Cielo após a autorização da transação. Para tanto, é preciso configurar a requisição de transação definindo-se o valor “true” para a TAG <code class="prettyprint">&lt;capturar&gt;</code>, conforme visto na seção “Criando uma transação”.</p>

<p>Já no segundo caso, é preciso fazer uma “captura posterior”, através de uma nova requisição ao Webservice da Cielo para confirmar a transação e receber o valor da venda.</p>

<aside class="warning">O prazo máximo para realizar a captura posterior é de 5 dias corridos após a data da autorização. Por exemplo, se uma autorização ocorreu em 10/12 às 15h20m45s, o limite para captura será às 15h20m45s do dia 15/12.</aside>

<aside class="notice">Na modalidade de débito não existe essa opção: toda transação de débito autorizada é capturada automaticamente.</aside>

<h3 id="captura-total-e-parcial">Captura Total e Parcial</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-captura</span> <span class="na">id=</span><span class="s">"adbc9961-8a39-452b-b7fd-15b44b464a97"</span> <span class="na">versao=</span><span class="s">"1.3.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tid&gt;</span>10069930690864281001<span class="nt">&lt;/tid&gt;</span>
    <span class="nt">&lt;dados-ec&gt;</span>
        <span class="nt">&lt;numero&gt;</span>1006993069<span class="nt">&lt;/numero&gt;</span>
        <span class="nt">&lt;chave&gt;</span>25fbb99741c739dd84d7b06ec78c9bac718838630f30b112d033ce2e621b34f3<span class="nt">&lt;/chave&gt;</span>
    <span class="nt">&lt;/dados-ec&gt;</span>
    <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
    <span class="nt">&lt;taxa-embarque&gt;</span>0<span class="nt">&lt;/taxa-embarque&gt;</span>
<span class="nt">&lt;/requisicao-captura&gt;</span>
</code></pre>

<ul>
<li><strong>Objetivo</strong> - Realizar a captura total e parcial de uma transação previamente autorizada.</li>
<li><strong>Regras</strong>

<ul>
<li>Disponível somente para transações dentro do prazo máximo de captura.</li>
<li>Caso o valor não seja informado, o sistema assumirá a captura do valor total.</li>
<li>O valor da captura deve ser menor ou igual ao valor da autorização.</li>
<li>Em caso de falha, novas tentativas de captura poderão ser feitas.</li>
<li>Em caso de sucesso, o status é alterado para “6 – Capturada”.</li>
<li><strong>Transações com Taxa de embarque:</strong></li>
<li>Na requisição de captura, o valor da taxa de embarque indica o montante do total que será capturado que deve ser destinado a esse fim.</li>
<li>Obrigatório caso seja captura parcial.</li>
<li>Caso a captura seja total, o sistema irá considerar o valor da taxa de embarque informado no requisição de autorização (<code class="prettyprint">&lt;requisicao-transacao&gt;</code>).</li>
</ul></li>
</ul>

<h3 id="retorno">Retorno</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;transacao</span> <span class="na">xmlns=</span><span class="s">"http://ecommerce.cbmp.com.br"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span> <span class="na">id=</span><span class="s">"0378c8cf4d"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;tid&gt;</span>10069930690360EF1001<span class="nt">&lt;/tid&gt;</span>
  <span class="nt">&lt;pan&gt;</span>uv9yI5tkhX9jpuCt+dfrtoSVM4U3gIjvrcwMBfZcadE=<span class="nt">&lt;/pan&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;captura&gt;</span>
    <span class="nt">&lt;codigo&gt;</span>6<span class="nt">&lt;/codigo&gt;</span>
    <span class="nt">&lt;mensagem&gt;</span>Transacao capturada com sucesso<span class="nt">&lt;/mensagem&gt;</span>
    <span class="nt">&lt;data-hora&gt;</span>2011-12-08T14:23:08.779-02:00<span class="nt">&lt;/data-hora&gt;</span>
    <span class="nt">&lt;valor&gt;</span>900<span class="nt">&lt;/valor&gt;</span>
    <span class="nt">&lt;taxa-embarque&gt;</span>900<span class="nt">&lt;/taxa-embarque&gt;</span>
  <span class="nt">&lt;/captura&gt;</span>
<span class="nt">&lt;/transacao&gt;</span>
</code></pre>

<p>Os campos do nó <captura> estão detalhados a seguir:</p>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>captura</td>
<td>Nó com dados da captura caso tenha passado por essa etapa.</td>
<td></td>
<td></td>
</tr>
<tr>
<td>captura.codigo</td>
<td>Numérico</td>
<td>1..2</td>
<td>Código do processamento</td>
</tr>
<tr>
<td>captura.mensagem</td>
<td>Alfanumérico</td>
<td>1..100</td>
<td>Detalhe do processamento.</td>
</tr>
<tr>
<td>captura.datahora</td>
<td>Alfanumérico</td>
<td>19</td>
<td>Data hora do processamento.</td>
</tr>
<tr>
<td>captura.valor</td>
<td>Numérico</td>
<td>1..12</td>
<td>Valor do processamento sem pontuação. Os dois últimos dígitos são os centavos.</td>
</tr>
<tr>
<td>captura.taxa-embarque</td>
<td>Numérico</td>
<td>1..9</td>
<td>Montante declarado como taxa de embarque que foi capturado.</td>
</tr>
</tbody></table>

<h2 id="cancelamento">Cancelamento</h2>

<p>O cancelamento é utilizado quando o lojista decide não efetivar um pedido de compra, seja por insuficiência de estoque, por desistência da compra pelo consumidor, ou qualquer outro motivo. Seu uso faz-se necessário principalmente se a transação estiver capturada, pois haverá débito na fatura do portador, caso ela não seja cancelada.</p>

<aside class="notice">Se a transação estiver apenas autorizada e a loja queira cancelá-la, o pedido de cancelamento não é necessário, pois após o prazo de captura expirar, ela será cancelada automaticamente pelo sistema.</aside>

<h3 id="cancelamento-total-e-parcial">Cancelamento Total e Parcial</h3>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;requisicao-cancelamento</span> <span class="na">id=</span><span class="s">"39d36eb6-5ae9-4308-89a1-455d299460c0"</span> <span class="na">versao=</span><span class="s">"1.3.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tid&gt;</span>100699306908642E1001<span class="nt">&lt;/tid&gt;</span>
    <span class="nt">&lt;dados-ec&gt;</span>
        <span class="nt">&lt;numero&gt;</span>1006993069<span class="nt">&lt;/numero&gt;</span>
        <span class="nt">&lt;chave&gt;</span>25fbb99741c739dd84d7b06ec78c9bac718838630f30b112d033ce2e621b34f3<span class="nt">&lt;/chave&gt;</span>
    <span class="nt">&lt;/dados-ec&gt;</span>
    <span class="nt">&lt;valor&gt;</span>0<span class="nt">&lt;/valor&gt;</span>
<span class="nt">&lt;/requisicao-cancelamento&gt;</span>
</code></pre>

<ul>
<li><strong>Objetivo</strong> - Realizar o cancelamento do valor total ou parcial de uma transação.</li>
<li><strong>Regras</strong>

<ul>
<li>O cancelamento total é válido tanto para transações capturadas, como autorizadas; o parcial é válido apenas para as capturadas.</li>
<li>O prazo de cancelamento é de até 300 dias para a modalidade crédito e D+0 para débito.</li>
<li>O cancelamento total, quando realizado com sucesso, altera o status da transação para “9 – Cancelada”, enquanto que o parcial não altera o status da transação, mantendo-a como “6 – Capturada”.</li>
<li>Em caso de cancelamento na versão 1.6.1 (esta versão é exclusiva para cancelamento), o status de cancelamento parcial será diferente, ou seja: se cancelado com sucesso, retorna status 9; caso ocorra um erro no cancelamento parcial, o código de status será 6. Estas regras aplicam-se apenas para o cancelamento parcial.</li>
<li>Caso a TAG <code class="prettyprint">&lt;valor&gt;</code> não seja fornecida, o sistema assumirá um cancelamento total.</li>
<li>Para bandeira AMEX está disponível apenas o cancelamento total.</li>
<li>Para a modalidade débito, não existe a possibilidade de efetuar cancelamento parcial.</li>
<li><strong>Transações com Taxa de embarque:</strong></li>
<li>Transações capturadas com o mesmo valor da autorização (ou seja, captura total) possuem o mesmo tratamento para cancelamentos parciais e totais, pois o valor da taxa de embarque é cancelado integralmente.</li>
</ul></li>
</ul>

<table><thead>
<tr>
<th>Elemento</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Tamanho</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>tid</td>
<td>Alfanumérico</td>
<td>Sim</td>
<td>1..40</td>
<td>Identificador da transação.</td>
</tr>
<tr>
<td>dados-ec.numero</td>
<td>Numérico</td>
<td>Sim</td>
<td>1..10</td>
<td>Número de credenciamento da loja com a Cielo.</td>
</tr>
<tr>
<td>dados-ec.chave</td>
<td>Alfanumérico</td>
<td>Sim</td>
<td>1..100</td>
<td>Chave de acesso da loja atribuída pela Cielo.</td>
</tr>
<tr>
<td>valor</td>
<td>Numérico</td>
<td>Opcional</td>
<td>1..12</td>
<td>Valor a ser cancelado. <strong>Caso não seja informado, será um cancelamento total.</strong></td>
</tr>
</tbody></table>

<h4 id="retorno">Retorno</h4>
<pre><code class="highlight xml"><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="nt">&lt;transacao</span> <span class="na">xmlns=</span><span class="s">"http://ecommerce.cbmp.com.br"</span> <span class="na">versao=</span><span class="s">"1.2.1"</span> <span class="na">id=</span><span class="s">"2c18f00a-3ff6-4c85-8865-a4fde599b2b2"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;tid&gt;</span>100699306903613E1001<span class="nt">&lt;/tid&gt;</span>
  <span class="nt">&lt;pan&gt;</span>uv9yI5tkhX9jpuCt+dfrtoSVM4U3gIjvrcwMBfZcadE=<span class="nt">&lt;/pan&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;cancelamentos&gt;</span>
    <span class="nt">&lt;cancelamento&gt;</span>
      <span class="nt">&lt;codigo&gt;</span>9<span class="nt">&lt;/codigo&gt;</span>
      <span class="nt">&lt;mensagem&gt;</span>Transacao cancelada com sucesso<span class="nt">&lt;/mensagem&gt;</span>
      <span class="nt">&lt;data-hora&gt;</span>2011-12-08T16:46:35.109-02:00<span class="nt">&lt;/data-hora&gt;</span>
      <span class="nt">&lt;valor&gt;</span>1000<span class="nt">&lt;/valor&gt;</span>
    <span class="nt">&lt;/cancelamento&gt;</span>
  <span class="nt">&lt;/cancelamentos&gt;</span>
<span class="nt">&lt;/transacao&gt;</span>
</code></pre>

<aside class="notice">Os cancelamentos (parciais ou totais) das transações com taxa de embarque e captura parcial não serão acatadas automaticamente pelo sistema.</aside>

<h1 id="testes-e-homologação">Testes e Homologação</h1>

<h2 id="endpoint">Endpoint</h2>

<p>Os testes de integração deverão ser realizados antes do início da homologação, durante o desenvolvimento (codificação) da solução. Para isso, deve-se considerar o seguinte ambiente como EndPoint do Webservice: <a href="https://qasecommerce.cielo.com.br/servicos/ecommwsec.do">https://qasecommerce.cielo.com.br/servicos/ecommwsec.do</a></p>

<aside class="warning">Toda a conexão aos serviços da Cielo deve ser feita através das URL’s divulgadas neste manual. A Cielo desaconselha fortemente a conexão direta via IP, uma vez que estes podem variar sem aviso prévio.</aside>

<h2 id="dados-para-testes">Dados para testes</h2>

<p>A massa de dados para realizar os testes neste ambiente está disposta na tabela abaixo:</p>

<table><thead>
<tr>
<th>Bandeira</th>
<th>Autenticação</th>
<th>Número do cartão de teste</th>
<th>Validade</th>
<th>Código de segurança - CVC</th>
</tr>
</thead><tbody>
<tr>
<td>Visa</td>
<td>Sim</td>
<td>4012001037141112</td>
<td>05/2018</td>
<td>123</td>
</tr>
<tr>
<td>Mastercard</td>
<td>Sim</td>
<td>5453010000066167</td>
<td>05/2018</td>
<td>123</td>
</tr>
<tr>
<td>Visa</td>
<td>Não</td>
<td>4012001038443335</td>
<td>05/2018</td>
<td>123</td>
</tr>
<tr>
<td>Mastercard</td>
<td>Não</td>
<td>5453010000066167</td>
<td>05/2018</td>
<td>123</td>
</tr>
<tr>
<td>Amex</td>
<td>Não</td>
<td>376449047333005</td>
<td>05/2018</td>
<td>1234</td>
</tr>
<tr>
<td>Diners</td>
<td>Não</td>
<td>36490102462661</td>
<td>05/2017</td>
<td>123</td>
</tr>
<tr>
<td>Elo</td>
<td>Não</td>
<td>6362970000457013</td>
<td>05/2018</td>
<td>123</td>
</tr>
<tr>
<td>Diners</td>
<td>Não</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Discover</td>
<td>Não</td>
<td>6011020000245045</td>
<td>05/2018</td>
<td>123</td>
</tr>
<tr>
<td>JCB</td>
<td>Não</td>
<td>3566007770004971</td>
<td>05/2018</td>
<td>123</td>
</tr>
<tr>
<td>Aura</td>
<td>Não</td>
<td>5078601912345600019</td>
<td>05/2018</td>
<td>123</td>
</tr>
</tbody></table>

<h2 id="chave-de-testes">Chave de testes</h2>

<p>Para facilitar o desenvolvimento disponibilizamos duas chaves para testes, uma para cada modalidade de integração. Com base nas configurações iniciais feitas durante o seu credenciamento, escolha os dados corretos para realizar os testes:</p>

<table><thead>
<tr>
<th>Número estabelecimento comercial</th>
<th>Chave de testes</th>
</tr>
</thead><tbody>
<tr>
<td>1006993069</td>
<td>25fbb99741c739dd84d7b06ec78c9bac718838630f30b112d033ce2e621b34f3</td>
</tr>
</tbody></table>

<aside class="warning">O valor do pedido além de seguir o formato sem pontos ou vírgulas decimais, deve terminar em “00”, caso contrário, a autorização será sempre negada. Exemplo: R$ 15,00 deve ser formatado como “1500”.</aside>

<aside class="notice">O ambiente de testes só deve ser utilizado pelos estabelecimentos de testes listados no quadro acima. O uso de dados originais do estabelecimento gerará transações não possíveis de rastreamento, gerando resultados incorretos. No ambiente de testes, use as credenciais para testes, no ambiente de produção, use os dados originais do estabelecimento.</aside>

<p>Após a conclusão do desenvolvimento, a etapa de Homologação garantirá que a implementação foi adequada e a solução do Cliente está apta para interagir no ambiente produtivo da Cielo. Ela sempre acontece depois que o desenvolvimento foi finalizado e testado. É composta pelas seguintes etapas:</p>

<p><img alt="fluxo testes" src="images/fluxo-testes.png" /></p>

<ol>
<li>Finalização do Cadastro: nesta etapa o Cliente deve enviar um email para <a href="mailto:cieloecommerce@cielo.com.br">cieloecommerce@cielo.com.br</a>, solicitando a Chave de Produção. A mensagem deve conter as
seguintes informações, que irão completar o cadastro:

<ul>
<li>URL Definitiva do site (ambiente de produção).</li>
<li>Nome da empresa responsável pelo desenvolvimento da integração.</li>
<li>Nome e e-mail do técnico (desenvolvedor) responsável pela integração.</li>
<li>Número de credenciamento (junto à Cielo) da loja virtual.</li>
<li>Razão social e nome fantasia da loja virtual.</li>
<li>Um usuário e senha na loja virtual para efetuar compras de testes.</li>
<li>URL do logotipo da loja no formato GIF e tamanho de 112X25 pixels.</li>
</ul></li>
</ol>

<aside class="notice">A imagem do logotipo deve estar hospedada em ambiente seguro (HTTPS), caso contrário o consumidor receberá notificações de segurança que podem culminar no abandono da compra.</aside>

<p>Em resposta, a Cielo retornará uma chave válida no ambiente de produção. Logo, a loja está habilitada a realizar seus testes nesse ambiente. Inicia-se a segunda etapa. É importante que testes sejam realizados para cobrir os seguintes tópicos:</p>

<ul>
<li>Interação com o Webservice: testes com a conexão utilizada.</li>
<li>Integração visual: a ida e a volta do fluxo a Cielo (fluxos alternativos devem ser</li>
<li>considerados).</li>
<li>Aplicação correta da marca da bandeira.</li>
<li>Modalidades de pagamento: testes com as combinações possíveis de pagamento.</li>
</ul>

<p>Neste momento, deve-se considerar o ambiente: <a href="https://ecommerce.cielo.com.br/servicos/ecommwsec.do">https://ecommerce.cielo.com.br/servicos/ecommwsec.do</a></p>

<aside class="notice">A integração da loja virtual deverá ser feita sempre através da URL acima e não por IP.</aside>

<p>Os testes em produção devem ser feitos com cartões de propriedade da Loja ou cujo portador tenha autorizado seu uso, uma vez que neste ambiente existe compromisso financeiro sobre as transações realizadas.</p>

<p>Ao término, uma nova solicitação deve ser enviada para cieloecommerce@cielo.com.br, para que a Cielo realize a homologação de fato. Um conjunto de testes será executado aprovar e negar transações. O resultado “HOMOLOGADO” é enviado por e-mail. Caso haja algum ponto que não permite a conclusão da homologação, a informação será igualmente enviada por email solicitando as correções necessárias.</p>

<h1 id="considerações-finais">Considerações Finais</h1>

<h2 id="regras-para-leitura-do-cartão-na-loja">Regras para leitura do cartão na loja</h2>

<p>A leitura dos dados do cartão no ambiente próprio é controlada por regras definidas pelo programa de segurança imposto pelas bandeiras de cartões.</p>

<p>Para a Visa, esse programa é o conhecido como AIS (Account Information Security) PCI. Para maiores informações acesse: <a href="www.cielo.com.br">www.cielo.com.br</a> &gt; Serviços &gt; Serviços de Segurança &gt; AIS – Programa de Segurança da Informação , ou entre em contato conosco.</p>

<p>Para a Mastercard o programa de segurança é o SDP (Site Data Protection) PCI. Para maiores informações acesse: <a href="http://www.mastercard.com/us/sdp/index.html">http://www.mastercard.com/us/sdp/index.html</a>, ou entre em contato conosco.</p>

<p>Ademais, atendidos os requisitos, no momento do credenciamento E-commerce deve ser mencionada a escolha por leitura do cartão na própria loja.</p>

<h2 id="certificado-digital">Certificado digital</h2>

<p>Em alguns ambientes é preciso extrair o Certificado Digital que a aplicação do Cielo E-commerce utiliza para ser instalado na Trustedstore do cliente, especialmente em ambientes Java e PHP.</p>

<p>Para obter o certificado, abra um browser e acesse <a href="http://ecommerce.cielo.com.br">http://ecommerce.cielo.com.br</a> e clique no ícone que exibe as informações sobre o certificado:</p>

<p><strong>Google Chrome</strong>:</p>

<p><img alt="Certificado no Google Chrome" src="images/certificado-chrome.png" /></p>

<p><strong>Mozilla Firefox</strong>:</p>

<p><img alt="Certificado no Mozilla Firefox" src="images/certificado-firefox.png" /></p>

<p><strong>Internet Explorer</strong>:</p>

<p><img alt="Certificado no Internet Explorer" src="images/certificado-ie.png" /></p>

<p>Programa <strong>Verified by Visa</strong> (Visa)</p>

<p>Programa internacional da Visa para possibilitar a autenticação do comprador no momento de uma compra em ambiente E-commerce. Visite <a href="http://www.verifiedbyvisa.com.br/">http://www.verifiedbyvisa.com.br/</a> para maiores informações.</p>

<p>Programa <strong>Secure Code</strong> (Mastercard)</p>

<p>Programa internacional da Mastercard para possibilitar a autenticação do comprador no momento de uma compra em ambiente E-commerce. Visite <a href="http://www.mastercard.com/securecode">http://www.mastercard.com/securecode</a> para maiores informações.</p>

            </div>
            <div class="dark-box">
                <div class="lang-selector">
                    <a href="#" data-language-name="xml">XML</a>
                </div>
            </div>
        </div>
    </body>
    </html>
